/* ==========================================================================
   HEADER + POPOVER — THEME-SAFE FINAL SCSS
   Drop this into your header component SCSS (replace older popover/header rules)
   - Ensures fixed/same width, 16px rounded curves, theme tokens usage
   - Works with PrimeNG p-popover (styleClass="premium-popover-override")
   - Uses ::ng-deep where popover is appended to body
   ========================================================================== */

/* -------------------------
   POPOVER (PrimeNG) OVERRIDES
   ------------------------- */
/* ::ng-deep required because p-popover is appended to body */
:host ::ng-deep .premium-popover-override {
  /* Shell sizing & placement */
  min-width: 360px; /* same width you requested */
  width: 360px; /* force same width */
  max-width: calc(95vw); /* responsive fallback */
  border: none !important;
  background: transparent !important;
  margin-top: 10px !important;
  z-index: var(--z-tooltip, 700) !important; /* ensure above other UI */

  /* Remove arrow decorations for a clean floating pill */
  &.p-popover-top::after,
  &.p-popover-top::before,
  &.p-popover-bottom::after,
  &.p-popover-bottom::before {
    display: none !important;
  }

  /* Actual content area inside the popover */
  .p-popover-content {
    padding: 0 !important; /* we manage padding inside children */
    box-sizing: border-box !important;

    /* THEME TOKENS — force them so popover doesn't get camouflaged */
    background: var(--bg-secondary) !important;
    color: var(--text-primary) !important;

    /* Rounded curve and border */
    border-radius: 16px !important; /* your rounded curve */
    border: 1px solid var(--border-primary) !important;

    /* Depth consistent with tokens */
    box-shadow: var(--shadow-xl) !important;

    /* Prevent inner overflow clipping of radius */
    overflow: hidden !important;
  }
}

/* If PrimeNG renders a different wrapper class, catch it too */
:host ::ng-deep .premium-popover-override.p-overlaypanel,
:host ::ng-deep .premium-popover-override.p-overlay {
  min-width: 360px;
  width: 360px;
  max-width: calc(95vw);
}

/* -------------------------
   HEADER (Main)
   ------------------------- */
.header-inner {
  height: 56px; /* ⬅️ perfect SaaS density */
  padding: 0 var(--spacing-xl);
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-primary);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* LEFT */
.header-left {
  display: flex;
  align-items: center;
  gap: 1rem;

  .menu-toggle-btn {
    width: 36px;
    height: 36px;
    border-radius: var(--ui-border-radius);
    border: none;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-fast);
    &:hover {
      background: var(--component-bg-hover);
      color: var(--text-primary);
    }
  }

  .logo-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    font-weight: 700;
    color: var(--text-primary);

    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--accent-primary);
      border-radius: var(--ui-border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
  }
}
.logo-link svg {
  height: 32px; /* visual normalization */
  width: auto;
  display: block;
}

/* RIGHT */
.header-right {
  display: flex;
  align-items: center;
  gap: 1rem;

  .notification-btn {
    position: relative;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-fast);
    &:hover {
      background: var(--component-bg-hover);
      color: var(--accent-primary);
    }
    &.has-new::after {
      content: '';
      position: absolute;
      top: 9px;
      right: 9px;
      width: 9px;
      height: 9px;
      background: var(--color-error);
      border-radius: 50%;
      border: 2px solid var(--bg-secondary);
    }
  }

  .user-profile-trigger {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 2px 10px 2px 4px;
    min-height: 34px;
    border-radius: 99px;
    border: 1px solid transparent;
    background: transparent;
    cursor: pointer;
    transition: var(--transition-fast);
    &:hover {
      background: var(--component-bg-hover);
      border-color: var(--border-primary);
    }
    .user-meta {
      display: flex;
      flex-direction: column;
      .name {
        font-size: var(--font-size-sm);
        font-weight: 600;
        color: var(--text-primary);
      }
      .role {
        font-size: 0.7rem;
        color: var(--text-secondary);
      }
    }
  }
}

/* -------------------------
   POPOVER INTERNAL LAYOUT
   ------------------------- */
.popover-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  box-sizing: border-box;
}

/* Tabs area (pills) */
.popover-tabs-container {
  padding: 1rem;
}
.popover-tabs {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  padding: 4px;
  background: var(--bg-ternary);
  border-radius: 12px;
  border: 1px solid var(--border-primary);
  position: relative;
  isolation: isolate;

  .tab-slider {
    position: absolute;
    top: 4px;
    left: 4px;
    width: calc(50% - 4px);
    height: calc(100% - 8px);
    background: var(--bg-secondary);
    border-radius: 8px;
    box-shadow: var(--shadow-sm);
    transition: transform 0.18s ease;
    z-index: 0;
  }

  .tab-btn {
    position: relative;
    z-index: 1; /* above slider */
    padding: 8px;
    border: none;
    background: transparent;
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    &.active {
      color: var(--text-primary);
    }
    .tab-badge {
      background: var(--color-error);
      color: #fff;
      padding: 0 6px;
      font-size: 0.7rem;
      border-radius: 10px;
      min-width: 18px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }
}

/* User header inside popover */
.user-header {
  padding: 1.25rem 1.25rem;
  display: flex;
  gap: 1rem;
  align-items: center;
  background: transparent; /* parent (.p-popover-content) provides bg */
  border-bottom: 1px solid var(--border-primary);
  ::ng-deep .xl-avatar {
    width: 60px;
    height: 60px;
    font-size: 1.7rem;
    background: var(--accent-primary);
    color: #fff;
  }
  .user-details {
    h4 {
      margin: 0;
      font-size: var(--font-size-md);
      font-weight: 700;
      color: var(--text-primary);
    }
    span {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }
  }
}

/* Theme selector */
.theme-selector {
  padding: 1rem 1.25rem;
  .section-title {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    span {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--text-label);
    }
  }
  .theme-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 8px;
    .theme-option {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      border: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-fast);
      &:hover {
        transform: translateY(-2px);
      }
      &.active {
        box-shadow: 0 0 0 2px var(--bg-secondary), 0 0 0 4px var(--accent-primary);
        border-color: transparent;
      }
      i {
        color: #fff;
        font-size: 0.9rem;
      }
    }
  }
}

/* Menu actions */
.menu-actions {
  padding: 0.75rem 1rem 1rem;
  display: flex;
  flex-direction: column;
  gap: 6px;
  border-top: 1px solid var(--border-primary);

  .menu-item {
    display: flex;
    gap: 1rem;
    align-items: center;
    padding: 0.75rem;
    border-radius: 12px;
    background: transparent;
    text-decoration: none;
    cursor: pointer;
    transition: var(--transition-fast);
    width: 100%;
    .icon-box {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--bg-ternary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
    }
    .icon-box.danger {
      background: rgba(239, 68, 68, 0.08);
      color: var(--color-error);
    }
    .item-text {
      display: flex;
      flex-direction: column;
      .label {
        color: var(--text-primary);
        font-weight: 600;
      }
      .sub-label {
        color: var(--text-secondary);
        font-size: 0.7rem;
      }
    }
    .arrow {
      margin-left: auto;
      color: var(--text-secondary);
    }
    &:hover {
      background: var(--component-bg-hover);
      .icon-box {
        background: #fff;
        color: var(--accent-primary);
        box-shadow: var(--shadow-sm);
      }
      .icon-box.danger {
        background: var(--color-error);
        color: #fff;
      }
    }
  }
}

/* Notification wrapper (embedded component) */
.notification-wrapper {
  height: 400px;
  overflow-y: auto;
  ::ng-deep app-notification-bell {
    .notification-panel {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
      padding: 0 !important;
    }
    .panel-header {
      display: none !important;
    }
    .panel-body {
      padding: 0 !important;
    }
  }
}

/* MOBILE: shrink popover width on very small screens */
@media (max-width: 420px) {
  :host ::ng-deep .premium-popover-override {
    width: calc(92vw) !important;
    min-width: unset !important;
    left: 4vw !important;
    right: 4vw !important;
  }
}
:host ::ng-deep .premium-popover-override .p-popover-content {
  max-height: min(80vh, 520px);
}
:host ::ng-deep .premium-notification-dialog .p-dialog {
  width: min(720px, 94vw);
  max-height: min(85vh, 720px);
}
