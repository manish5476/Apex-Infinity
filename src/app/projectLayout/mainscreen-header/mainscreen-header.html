<div class="header-inner">
  <div class="header-left">
    <button class="menu-toggle-btn" (click)="toggleSidebar.emit()">
      <i class="pi pi-bars"></i>
    </button>
    <a routerLink="/admin/dashboard" class="logo-link">
      <!-- <div class="logo-icon">
        <i class="pi pi-bolt"></i>
      </div> -->
      <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
        x="0px" y="0px" viewBox="0 0 1000 500" style="enable-background:new 0 0 1000 500;" xml:space="preserve"
        class="h-16 w-auto">
        <style type="text/css">
          .main-text {
            font-family: 'Georgia', 'Times New Roman', serif;
            font-weight: bold;
            font-size: 68px;
            fill: url(#text-gold-grad);
            filter: url(#dropShadow);
          }

          .tagline-text {
            font-family: 'Segoe UI', 'Verdana', sans-serif;
            font-size: 16px;
            letter-spacing: 6px;
            fill: #5D4037;
            text-transform: uppercase;
            font-weight: 600;
          }

          .divider-style {
            fill: none;
            stroke: #8C5E4A;
            stroke-width: 2;
          }

          .divider-diamond {
            fill: #8C5E4A;
          }
        </style>
        <defs>
          <linearGradient id="text-gold-grad" gradientUnits="userSpaceOnUse" x1="300" y1="400" x2="700" y2="400">
            <stop offset="0" style="stop-color:#8B5A2B" />
            <stop offset="0.3" style="stop-color:#CDA434" />
            <stop offset="0.5" style="stop-color:#FCE6C9" />
            <stop offset="0.7" style="stop-color:#CDA434" />
            <stop offset="1" style="stop-color:#8B5A2B" />
          </linearGradient>
          <linearGradient id="logo-border-grad" gradientUnits="userSpaceOnUse" x1="344" y1="289.5" x2="733" y2="289.5">
            <stop offset="0" style="stop-color:#B88A4D" />
            <stop offset="0.20" style="stop-color:#EDC988" />
            <stop offset="0.40" style="stop-color:#B88A4D" />
            <stop offset="0.60" style="stop-color:#EDC988" />
            <stop offset="0.80" style="stop-color:#B88A4D" />
            <stop offset="1" style="stop-color:#EDC988" />
          </linearGradient>
          <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="2" />
            <feOffset dx="2" dy="2" result="offsetblur" />
            <feComponentTransfer>
              <feFuncA type="linear" slope="0.5" />
            </feComponentTransfer>
            <feMerge>
              <feMergeNode />
              <feMergeNode in="SourceGraphic" />
            </feMerge>
          </filter>
        </defs>
        <g>
          <path
            style="fill:none;stroke:url(#logo-border-grad);stroke-width:6;stroke-linecap:round;stroke-linejoin:round;"
            d="M344,443l125-307l49,137c15,36,49,84,99,110c50,26,100,11,116-36c16-47-12-100-62-126 c-50-26-94,0-135,33L413,357L344,443" />
        </g>
        <g transform="translate(500, 380)">
          <text x="0" y="50" text-anchor="middle" class="main-text">APEX-INFINITY</text>
          <g transform="translate(0, 70)">
            <line x1="-120" y1="0" x2="-15" y2="0" class="divider-style" />
            <rect x="-6" y="-6" width="12" height="12" transform="rotate(45)" class="divider-diamond" />
            <line x1="15" y1="0" x2="120" y2="0" class="divider-style" />
          </g>
          <text x="0" y="100" text-anchor="middle" class="tagline-text">EMPOWERING INNOVATION</text>
        </g>
      </svg>
      <span>Apex Infinity</span>
    </a>
  </div>

  <div class="header-right">

    <button (click)="showNotificationdialog = true"  class="notification-btn" [class.has-new]="recentNotifications && recentNotifications.length > 0" pTooltip="Notifications" tooltipPosition="bottom">
      <i class="pi pi-bell text-lg"></i>
    </button>

    @if (currentUser) {
    <button class="user-profile-trigger" (click)="op.toggle($event)">
      <p-avatar [label]="getInitials(currentUser?.name)" shape="circle"
        [style]="{'background-color': 'var(--accent-primary)', 'color': '#fff', 'font-weight': '700'}">
      </p-avatar>
      <div class="user-meta hidden md:flex">
        <span class="name">{{ currentUser?.name }}</span>
        <span class="role">{{ currentUser?.role.name || 'Admin' }}</span>
      </div>
      <i class="pi pi-angle-down text-xs opacity-60 hidden md:block" style="color: var(--text-secondary)"></i>
    </button>

    <p-popover #op appendTo="body" [showTransitionOptions]="'150ms cubic-bezier(0, 0, 0.2, 1)'"
      [hideTransitionOptions]="'100ms linear'" styleClass="premium-popover-override">

      <div class="popover-container">

        <div class="popover-tabs-container">
          <div class="popover-tabs">
            <div class="tab-slider"
              [style.transform]="activeTab === 'settings' ? 'translateX(0%)' : 'translateX(100%)'"></div>

            <button class="tab-btn" [class.active]="activeTab === 'settings'" (click)="activeTab = 'settings'">
              Settings
            </button>

            <button class="tab-btn" [class.active]="activeTab === 'notifications'"
              (click)="activeTab = 'notifications'">
              Notifications
              @if (recentNotifications.length) {
              <span class="tab-badge">{{ recentNotifications.length }}</span>
              }
            </button>
          </div>
        </div>

        @if (activeTab === 'settings') {
        <div class="user-header">
          <p-avatar [label]="getInitials(currentUser?.name)" styleClass="xl-avatar"></p-avatar>
          <div class="user-details">
            <h4>{{ currentUser?.name }}</h4>
            <span>{{ currentUser?.email }}</span>
          </div>
        </div>

        <div class="theme-selector">
          <div class="section-title">
            <span>Appearance</span>
            <p-toggleButton [(ngModel)]="isDarkMode" onIcon=" pi-moon" offIcon="pi pi-sun" styleClass="mini-toggle"
              (onChange)="toggleDarkMode($event.checked)">
            </p-toggleButton>
          </div>

          <div class="theme-grid">
            @for (theme of allThemes; track theme.id) {
            <div class="theme-option" [style.background-color]="theme.color" [class.active]="activeThemeId === theme.id"
              [pTooltip]="theme.name" tooltipPosition="top" (click)="selectTheme(theme.id)">
              @if (activeThemeId === theme.id) {
              <i class="pi pi-check"></i>
              }
            </div>
            }
          </div>
        </div>

        <div class="menu-actions">
          <a routerLink="/user/profile" class="menu-item" (click)="op.hide()">
            <div class="icon-box"><i class="pi pi-user"></i></div>
            <div class="item-text">
              <span class="label">Profile Settings</span>
              <span class="sub-label">Manage account</span>
            </div>
            <i class="pi pi-chevron-right arrow"></i>
          </a>

          <a routerLink="/auth/update-password" class="menu-item" (click)="op.hide()">
            <div class="icon-box"><i class="pi pi-lock"></i></div>
            <div class="item-text">
              <span class="label">Security</span>
              <span class="sub-label">Password & 2FA</span>
            </div>
            <i class="pi pi-chevron-right arrow"></i>
          </a>

          <button class="menu-item danger" (click)="logout(); op.hide()">
            <div class="icon-box danger"><i class="pi pi-power-off"></i></div>
            <span class="label">Sign Out</span>
          </button>
        </div>
        }

        @if (activeTab === 'notifications') {
        <div class="notification-wrapper custom-scrollbar">
          <app-notification-bell></app-notification-bell>
        </div>
        }

      </div>
    </p-popover>
    }
    @else {
    <a routerLink="/auth/login" class="login-btn">Login</a>
    }

  </div>
</div>

<p-dialog [(visible)]="showNotificationdialog" [modal]="true" [draggable]="false" [resizable]="false"
  [dismissableMask]="true" [showHeader]="false" styleClass="premium-notification-dialog"
  [style]="{ width: '80%', maxHeight: '85vh', borderRadius: '16px', overflow: 'hidden' }"
  maskStyleClass="backdrop-blur-sm bg-black/40">
  <app-notification-bell></app-notification-bell>
</p-dialog>