<p-toast></p-toast>

<div class="customer-wrapper">
  <section class="customer-container">

    <div class="customer-form-panel animate-fadeIn">
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="customer-form-layout">
        <div class="customer-form-header">
          <div class="flex justify-between items-center">
            <div>
              <h1 class="form-title">{{ formTitle() }}</h1>
              <p class="form-subtitle">Fill in the product details below. <span class="req">*</span> = required</p>
            </div>
            <div class="flex items-center gap-2">
              <label for="isActive" class="text-xs uppercase font-bold text-[var(--text-secondary)]">Active  Status</label>
              <p-togglebutton formControlName="isActive" onLabel="On" offLabel="Off" class="w-24" />
            </div>
          </div>
        </div>

        <div class="customer-form-body">

          <section class="form-section">
            <h4 class="section-title">Basic Information</h4>
            <div class="form-grid">
              <div class="form-group col-span-2">
                <label>Product Name <span class="req">*</span></label>
                <input pInputText formControlName="name" placeholder="e.g., Wireless Mouse" />
              </div>
              <div class="form-group">
                <label>SKU</label>
                <input pInputText formControlName="sku" placeholder="e.g., WM-1001" />
              </div>
            </div>

            <div class="form-group">
              <label>Description</label>
              <textarea pInputTextarea formControlName="description" rows="3"
                placeholder="Describe the product features..."></textarea>
            </div>
          </section>

          <section class="form-section">
            <h4 class="section-title">Categorization</h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Brand</label>
                <p-select optionLabel="name" optionValue="value" appendTo="body" appendTo="body" formControlName="brand" [options]="this.masterList.brands()" placeholder="Select Brand"
                  [filter]="true"></p-select>
              </div>
              <div class="form-group">
                <label>Category</label>
                <p-select optionLabel="name" optionValue="value" appendTo="body" appendTo="body" formControlName="category" [options]="this.masterList.categories()"
                  placeholder="Select Category" [filter]="true"></p-select>
              </div>
            </div>
          </section>

          <section class="form-section">
            <h4 class="section-title">Pricing & Tax</h4>
            <div class="form-grid-4">
              <div class="form-group">
                <label>Selling Price (MRP) <span class="req">*</span></label>
                <p-inputNumber formControlName="sellingPrice" mode="currency" currency="INR"
                  locale="en-IN"></p-inputNumber>
              </div>
              <div class="form-group">
                <label>Purchase Price</label>
                <p-inputNumber formControlName="purchasePrice" mode="currency" currency="INR"
                  locale="en-IN"></p-inputNumber>
              </div>
              <div class="form-group">
                <label>Tax Rate (%)</label>
                <p-inputNumber formControlName="taxRate" suffix="%"></p-inputNumber>
              </div>
              <div class="form-group align-bottom">
                <div
                  class="flex items-center gap-2 p-2 border border-[var(--border-primary)] rounded bg-[var(--bg-ternary)]">
                  <p-checkbox formControlName="isTaxInclusive" [binary]="true" inputId="taxInclusive"></p-checkbox>
                  <label for="taxInclusive" class="checkbox-label cursor-pointer">Tax Inclusive</label>
                </div>
              </div>
            </div>
          </section>

          <section class="form-section">
            <div class="flex justify-between items-center mb-2">
              <h4 class="section-title m-0">Inventory Stock</h4>
              <p-button label="Add Location" icon="pi pi-plus" size="small" styleClass="p-button-outlined"
                (onClick)="addInventoryItem()"></p-button>
            </div>

            <div formArrayName="inventory" class="inventory-container">

              @for (item of inventory.controls; track i; let i = $index) {
              <div [formGroupName]="i" class="inventory-item-grid animate-slideInUp">
                <div class="form-group">
                  <label>Branch</label>
                  <p-select appendTo="body" appendTo="body" formControlName="branchId" [options]="branchOptions()" optionLabel="name"
                    optionValue="_id" placeholder="Select Branch"></p-select>
                </div>

                <div class="form-group">
                  <label>Qty</label>
                  <p-inputNumber formControlName="quantity" [showButtons]="true" buttonLayout="horizontal" [step]="1"
                    inputStyleClass="w-full text-center"></p-inputNumber>
                </div>

                <div class="form-group">
                  <label>Re-order</label>
                  <p-inputNumber formControlName="reorderLevel"></p-inputNumber>
                </div>

                <div class="form-group align-bottom">
                  <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-text"
                    (onClick)="removeInventoryItem(i)" pTooltip="Remove Location"></p-button>
                </div>

              </div>
              } @empty {
              <div class="empty-state">
                <i class="pi pi-box text-4xl text-[var(--text-tertiary)]"></i>
                <p>No inventory locations added yet.</p>
                <p-button label="Add First Location" link="true" (onClick)="addInventoryItem()"></p-button>
              </div>
              }

            </div>
          </section>

          <section class="form-section">
            <h4 class="section-title">Additional Details</h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Default Supplier</label>
                <p-select appendTo="body" appendTo="body" formControlName="defaultSupplierId" [options]="supplierOptions()"
                  optionLabel="companyName" optionValue="_id" placeholder="Select Supplier" [filter]="true"></p-select>
              </div>
              <div class="form-group">
                <label>Tags</label>
                <app-chips formControlName="tags"></app-chips>
              </div>
            </div>
          </section>

        </div>

        <div class="customer-form-footer">
          <p-button label="Cancel" styleClass="p-button-text p-button-secondary" routerLink="/products"></p-button>
          <p-button [label]="editMode() ? 'Save Changes' : 'Create Product'" icon="pi pi-check" type="submit"
            [loading]="isSubmitting()" [disabled]="productForm.invalid || isSubmitting()">
          </p-button>
        </div>
      </form>
    </div>
  </section>
</div>