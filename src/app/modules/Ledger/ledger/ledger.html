<div class="page-container">

  <header class="page-header">
    <div class="title-row">
      <h1>
        <div class="icon-box">
          <i class="pi pi-book"></i>
        </div>
        Financial Ledger
      </h1>

      <div class="header-actions">
        
        <p-datepicker [formControl]="$any(filterForm.get('dateRange'))" selectionMode="range" [readonlyInput]="true"
          placeholder="Select Date Range" [showIcon]="true" appendTo="body" styleClass="w-full" inputStyleClass="w-full"
          (onClose)="applyFilters()">
        </p-datepicker>

        @if (currentTab() === 'customer') {
        <p-select [options]="customerOptions()" [formControl]="$any(filterForm.get('customerId'))"
          placeholder="Select Customer" [filter]="true" [showClear]="true" styleClass="w-full" appendTo="body"
          (onChange)="applyFilters()">
        </p-select>
        }

        @if (currentTab() === 'supplier') {
        <p-select [options]="supplierOptions()" [formControl]="$any(filterForm.get('supplierId'))"
          placeholder="Select Supplier" [filter]="true" [showClear]="true" styleClass="w-full" appendTo="body"
          (onChange)="applyFilters()">
        </p-select>
        }

        <p-button label="Export" icon="pi pi-download" styleClass="p-button-outlined p-button-secondary"
          [loading]="isExporting()" (onClick)="handleExportClick()">
        </p-button>

      </div>
    </div>
  </header>

  <div class="tabs-container">
    <p-tabs [value]="tabValue()" (valueChange)="onTabChange($event)">
      <p-tablist>
        <p-tab [value]="0">All Transactions</p-tab>
        <p-tab [value]="1">Customer Ledger</p-tab>
        <p-tab [value]="2">Supplier Ledger</p-tab>
        <p-tab [value]="3">Org Summary</p-tab>
        <p-tab [value]="4">Profit & Loss</p-tab>
        <p-tab [value]="5">Balance Sheet</p-tab>
        <p-tab [value]="6">Trial Balance</p-tab>
      </p-tablist>
    </p-tabs>
  </div>

  <div class="grid-container">
    
    @if (isLoading()) {
      <div class="p-4">
        <p-skeleton width="100%" height="40px" styleClass="mb-2"></p-skeleton>
        <p-skeleton width="100%" height="200px"></p-skeleton>
      </div>
    }
    @else if ((currentTab() === 'customer' && !filterForm.value.customerId) || (currentTab() === 'supplier' && !filterForm.value.supplierId)) {
      <div class="empty-placeholder">
        <div class="placeholder-icon"><i class="pi pi-filter"></i></div>
        <h3>Select a {{ currentTab() }}</h3>
        <p>Please select an entity from the dropdown to view their ledger.</p>
      </div>
    }
    @else {
      <div class="glass-panel">
        <app-ag-share-grid 
          [columns]="column()" 
          [data]="data()" 
          selectionMode="multiple" 
          (gridEvent)="eventFromGrid($event)"
          style="height: 100%; width: 100%; display: block;">
        </app-ag-share-grid>
      </div>
    }
  </div>

  @if (currentTab() === 'trialBalance' && data().length > 0) {
  <footer class="footer-summary">
    <div class="summary-group">
      <div class="total-item">
        <span>Total Debit</span>
        <strong class="text-error">{{ common.formatCurrency(getTrialTotal('debit')) }}</strong>
      </div>
      <div class="total-item">
        <span>Total Credit</span>
        <strong class="text-success">{{ common.formatCurrency(getTrialTotal('credit')) }}</strong>
      </div>
      <div class="total-item mismatch" *ngIf="(getTrialTotal('debit') - getTrialTotal('credit')) !== 0">
        <span>Difference</span>
        <strong>{{ common.formatCurrency(getTrialTotal('debit') - getTrialTotal('credit')) }}</strong>
      </div>
    </div>
  </footer>
  }

</div>

<p-dialog header="Export Transactions" [(visible)]="showExportDialog" [modal]="true" styleClass="glass-dialog" [draggable]="false">
  <div class="flex flex-column gap-4 pt-2" [formGroup]="exportForm">

    <div class="field">
      <label class="block mb-2 font-bold text-sm text-[var(--text-secondary)] uppercase">Date Range</label>
      <p-datepicker formControlName="dateRange" selectionMode="range" [readonlyInput]="true" [showIcon]="true"
        appendTo="body" styleClass="w-full" inputStyleClass="w-full"></p-datepicker>
    </div>

    <div class="field">
      <label class="block mb-2 font-bold text-sm text-[var(--text-secondary)] uppercase">Filter Data By</label>
      <div class="flex gap-4 p-3 bg-[var(--bg-ternary)] rounded border border-[var(--border-secondary)]">
        <div class="flex align-items-center gap-2">
          <p-radiobutton name="exportType" value="all" formControlName="exportType" label="All"></p-radiobutton>
        </div>
        <div class="flex align-items-center gap-2">
          <p-radiobutton name="exportType" value="customer" formControlName="exportType" label="Customer"></p-radiobutton>
        </div>
        <div class="flex align-items-center gap-2">
          <p-radiobutton name="exportType" value="supplier" formControlName="exportType" label="Supplier"></p-radiobutton>
        </div>
      </div>
    </div>

    @if (exportForm.get('exportType')?.value === 'customer') {
    <div class="field fadein">
      <label class="block mb-2 font-bold text-sm text-[var(--text-secondary)] uppercase">Select Customer</label>
      <p-select [options]="customerOptions()" formControlName="specificId" placeholder="Choose Customer" [filter]="true"
        styleClass="w-full" appendTo="body"></p-select>
    </div>
    }
    @if (exportForm.get('exportType')?.value === 'supplier') {
    <div class="field fadein">
      <label class="block mb-2 font-bold text-sm text-[var(--text-secondary)] uppercase">Select Supplier</label>
      <p-select [options]="supplierOptions()" formControlName="specificId" placeholder="Choose Supplier" [filter]="true"
        styleClass="w-full" appendTo="body"></p-select>
    </div>
    }

  </div>
  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button label="Cancel" styleClass="p-button-text p-button-secondary" (onClick)="showExportDialog.set(false)"></p-button>
      <p-button label="Download CSV" icon="pi pi-download" (onClick)="submitExportDialog()"
        [loading]="isExporting()"></p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- <div class="page-container">

  <header class="page-header">
    <div class="title-row">
      <h1>
        <i class="pi pi-book"></i>
        Financial Ledger
      </h1>

      <div class="header-actions">

        <p-datepicker [formControl]="$any(filterForm.get('dateRange'))" selectionMode="range" [readonlyInput]="true"
          placeholder="Select Date Range" [showIcon]="true" appendTo="body" styleClass="p-inputtext-sm date-filter"
          (onClose)="applyFilters()">
        </p-datepicker>

        @if (currentTab() === 'customer') {
        <p-select [options]="customerOptions()" [formControl]="$any(filterForm.get('customerId'))"
          placeholder="Select Customer" [filter]="true" [showClear]="true" styleClass="header-dropdown" appendTo="body"
          (onChange)="applyFilters()">
        </p-select>
        }

        @if (currentTab() === 'supplier') {
        <p-select [options]="supplierOptions()" [formControl]="$any(filterForm.get('supplierId'))"
          placeholder="Select Supplier" [filter]="true" [showClear]="true" styleClass="header-dropdown" appendTo="body"
          (onChange)="applyFilters()">
        </p-select>
        }

        <p-button label="Export" icon="pi pi-download" styleClass="p-button-outlined p-button-secondary p-button-sm"
          [loading]="isExporting()" (onClick)="handleExportClick()">
        </p-button>

      </div>
    </div>
  </header>

  <div class="tabs-container">
    <p-tabs [value]="tabValue()" (valueChange)="onTabChange($event)">
      <p-tablist>
        <p-tab [value]="0">All Transactions</p-tab>
        <p-tab [value]="1">Customer Ledger</p-tab>
        <p-tab [value]="2">Supplier Ledger</p-tab>
        <p-tab [value]="3">Org Summary</p-tab>
        <p-tab [value]="4">Profit & Loss</p-tab>
        <p-tab [value]="5">Balance Sheet</p-tab>
        <p-tab [value]="6">Trial Balance</p-tab>
      </p-tablist>
    </p-tabs>
  </div>

  <div class="grid-container">
    @if (isLoading()) {
    <div class="p-4">
      <p-skeleton width="100%" height="40px" styleClass="mb-2"></p-skeleton>
      <p-skeleton width="100%" height="200px"></p-skeleton>
    </div>
    }
    @else if ((currentTab() === 'customer' && !filterForm.value.customerId) ||
    (currentTab() === 'supplier' && !filterForm.value.supplierId)) {
    <div class="empty-placeholder">
      <i class="pi pi-filter"></i>
      <p>Please select a {{ currentTab() }} to view records.</p>
    </div>
    }
    @else {
  
     <app-ag-share-grid [columns]="column()" [data]="data()" selectionMode="multiple" (gridEvent)="eventFromGrid($event)">
    </app-ag-share-grid>
    }
  </div>

  @if (currentTab() === 'trialBalance' && data().length > 0) {
  <div class="footer-summary">
    <div class="total-item"><span>Debit:</span><strong>{{ common.formatCurrency(getTrialTotal('debit')) }}</strong>
    </div>
    <div class="total-item"><span>Credit:</span><strong>{{ common.formatCurrency(getTrialTotal('credit')) }}</strong>
    </div>
    <div class="total-item mismatch"><span>Diff:</span><strong>{{ common.formatCurrency(getTrialTotal('debit') -
        getTrialTotal('credit')) }}</strong></div>
  </div>
  }

</div>

<p-dialog header="Export Transactions" [(visible)]="showExportDialog" [modal]="true" [style]="{ width: '400px' }">
  <div class="flex flex-column gap-3 pt-2" [formGroup]="exportForm">

    <div class="field">
      <label class="block mb-2 font-bold">Date Range</label>
      <p-datepicker formControlName="dateRange" selectionMode="range" [readonlyInput]="true" [showIcon]="true"
        appendTo="body" styleClass="w-full"></p-datepicker>
    </div>

    <div class="field">
      <label class="block mb-2 font-bold">Filter Data By:</label>
      <div class="flex gap-3">
        <div class="flex align-items-center">
          <p-radiobutton name="exportType" value="all" formControlName="exportType" label="All"></p-radiobutton>
        </div>
        <div class="flex align-items-center">
          <p-radiobutton name="exportType" value="customer" formControlName="exportType"
            label="Customer"></p-radiobutton>
        </div>
        <div class="flex align-items-center">
          <p-radiobutton name="exportType" value="supplier" formControlName="exportType"
            label="Supplier"></p-radiobutton>
        </div>
      </div>
    </div>

    @if (exportForm.get('exportType')?.value === 'customer') {
    <div class="field fadein">
      <label class="block mb-2 font-bold">Select Customer</label>
      <p-select [options]="customerOptions()" formControlName="specificId" placeholder="Choose Customer" [filter]="true"
        styleClass="w-full" appendTo="body"></p-select>
    </div>
    }
    @if (exportForm.get('exportType')?.value === 'supplier') {
    <div class="field fadein">
      <label class="block mb-2 font-bold">Select Supplier</label>
      <p-select [options]="supplierOptions()" formControlName="specificId" placeholder="Choose Supplier" [filter]="true"
        styleClass="w-full" appendTo="body"></p-select>
    </div>
    }

  </div>
  <ng-template pTemplate="footer">
    <p-button label="Cancel" styleClass="p-button-text" (onClick)="showExportDialog.set(false)"></p-button>
    <p-button label="Download CSV" icon="pi pi-download" (onClick)="submitExportDialog()"
      [disabled]="isExporting()"></p-button>
  </ng-template>
</p-dialog>
 -->
