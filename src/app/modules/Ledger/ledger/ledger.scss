// @ '../../../../styles/themes.scss';

// --- THEME TOKEN CONSUMPTION ---
// Mapping global design tokens to local SCSS variables for readability
$bg-primary: var(--bg-primary);
$bg-secondary: var(--bg-secondary);
$bg-ternary: var(--bg-ternary);

$text-primary: var(--text-primary);
$text-secondary: var(--text-secondary);
$text-tertiary: var(--text-tertiary);

$border-primary: var(--border-primary);
$border-secondary: var(--border-secondary);

$accent-primary: var(--accent-primary);
$accent-gradient: var(--accent-gradient);
$accent-focus: var(--accent-focus);
$accent-hover: var(--accent-hover);

// Spacing
$spacing-xs: var(--spacing-xs);
$spacing-sm: var(--spacing-sm);
$spacing-md: var(--spacing-md);
$spacing-lg: var(--spacing-lg);
$spacing-xl: var(--spacing-xl);
$spacing-2xl: var(--spacing-2xl);
// Defining missing spacing variables to fix compilation error
$spacing-3xl: 2rem; 
$spacing-4xl: 3rem;
$spacing-5xl: 4rem;

// UI Constants
$radius-base: var(--ui-border-radius);
$radius-lg: var(--ui-border-radius-lg);
$radius-xl: var(--ui-border-radius-xl);
$shadow-sm: var(--shadow-sm);
$shadow-md: var(--shadow-md);
$shadow-lg: var(--shadow-lg);

// Fonts
$font-heading: var(--font-heading);
$font-body: var(--font-body);
$font-mono: var(--font-mono);

:host {
  display: block;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: $font-body;
  color: $text-primary;
}

// 1. PAGE LAYOUT
.ledger-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  background: $bg-primary;
  overflow: hidden;
  padding: $spacing-md;
  gap: $spacing-md;

  @media (max-width: 768px) {
    padding: $spacing-sm;
  }
}

// 2. HEADER
.glass-header {
  flex-shrink: 0;
  padding: $spacing-lg $spacing-xl;
  background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(255,255,255,0.4) 100%);
  border: var(--ui-border-width) solid $border-primary;
  border-radius: $radius-lg;
  box-shadow: $shadow-sm;
  display: flex;
  flex-direction: column;
  gap: $spacing-md;
  transition: var(--transition-base);

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; // Allows wrapping if screen is narrow
    gap: $spacing-md;
  }

  .title-section {
    display: flex;
    align-items: center;
    gap: $spacing-md;
    min-width: 200px; // Ensure title doesn't get crushed

    .icon-wrapper {
      width: 44px;
      height: 44px;
      background: $accent-gradient;
      border-radius: $radius-base;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: $shadow-md;
      
      i { 
        color: #ffffff; 
        font-size: 1.25rem; 
      }
    }

    h1 {
      margin: 0;
      font-family: $font-heading;
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: $text-primary;
      line-height: var(--line-height-tight);
    }
    p {
      margin: 2px 0 0 0;
      font-size: var(--font-size-sm);
      color: $text-secondary;
    }
  }

  // Unified Filter Row within Header
  .filters-row {
    display: flex;
    align-items: center;
    gap: $spacing-sm;
    flex: 1; // Take available space
    justify-content: flex-end; // Push to right
    flex-wrap: wrap; // Wrap filters to next line if needed
    
    // Ensure inputs in header look integrated and compact
    ::ng-deep .p-inputtext, ::ng-deep .p-select, ::ng-deep .p-datepicker {
        height: 36px; // Compact height for single row look
        font-size: var(--font-size-sm);
    }

    // Adjust width for specific inputs inside filter row
    .filter-search { width: 200px; }
    .filter-branch { width: 160px; }
    .filter-date { width: 220px; }
    .filter-account { width: 180px; }
    .filter-type { width: 100px; }
    .filter-entity { width: 200px; }
  }
}

// 3. TABS WRAPPER
.tabs-wrapper {
  margin-top: calc($spacing-md * -1); 
  border-top: var(--ui-border-width) solid $border-secondary;
  padding-top: $spacing-sm;
  
  ::ng-deep .p-tablist {
    background: transparent;
    border: none;
  }
}

// 4. MAIN CONTENT AREA
.ledger-content {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: $spacing-md;
  position: relative;
}

// 5. SUB-FILTERS (Removed or hidden as requested to move to header)
.sub-filters {
  display: none; // Hiding as filters are moved to header
}

// 6. GRID WRAPPER (Glass Panel)
.grid-wrapper.glass-panel {
  flex: 1;
  background: $bg-secondary;
  border: var(--ui-border-width) solid $border-primary;
  border-radius: $radius-lg;
  box-shadow: $shadow-sm;
  overflow: hidden;
  display: flex;
  flex-direction: column;

  app-ag-share-grid {
    flex: 1;
    width: 100%;
    height: 100%;
  }
}

// 7. ENTITY SUMMARY CARD
.entity-summary-card {
  flex-shrink: 0;
  background: $accent-gradient;
  border-radius: $radius-lg;
  padding: $spacing-lg $spacing-xl;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: $shadow-lg;
  margin-bottom: $spacing-sm;

  .details {
    h3 { 
      margin: 0; 
      font-family: $font-heading;
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-semibold);
    }
    p { 
      margin: 4px 0 0; 
      font-size: var(--font-size-md); 
      opacity: 0.9; 
      display: flex; 
      align-items: center; 
      gap: 6px; 
    }
  }

  .balances {
    display: flex;
    align-items: center;
    gap: $spacing-2xl;
    background: rgba(255,255,255,0.15);
    padding: $spacing-md $spacing-xl;
    border-radius: $radius-base;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.2);

    .bal-item {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      
      label { 
        font-size: var(--font-size-xs); 
        text-transform: uppercase; 
        letter-spacing: 0.5px; 
        opacity: 0.8; 
        margin-bottom: 2px;
        font-weight: var(--font-weight-medium);
      }
      span { 
        font-size: var(--font-size-lg); 
        font-weight: var(--font-weight-bold); 
        font-family: $font-mono;
      }
      
      &.closing span { 
        color: #fff; 
        text-shadow: 0 1px 2px rgba(0,0,0,0.1); 
      }
    }

    .divider {
      width: 1px;
      height: 32px;
      background: rgba(255,255,255,0.3);
    }
  }
}

// 8. EMPTY STATE
.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: $spacing-lg;
  color: $text-tertiary;
  padding: $spacing-2xl;

  img { opacity: 0.6; mix-blend-mode: multiply; width: 120px; }
  p { font-size: var(--font-size-md); margin: 0; }
}

// 9. FOOTER SUMMARY (Trial Balance)
.trial-footer {
  flex-shrink: 0;
  background: $bg-secondary;
  border: var(--ui-border-width) solid $border-primary;
  border-radius: $radius-lg;
  padding: $spacing-md $spacing-xl;
  display: flex;
  justify-content: flex-end;
  gap: $spacing-2xl;
  box-shadow: $shadow-sm;

  .tf-item {
    font-size: var(--font-size-sm);
    color: $text-secondary;
    display: flex;
    align-items: center;
    gap: $spacing-md;

    span {
      font-family: $font-mono;
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-lg);
    }
  }
}

// 10. REPORT VIEWS (Summary, P&L, BS)
.report-container {
  overflow-y: auto;
  padding-right: 4px;
  display: flex;
  flex-direction: column;
  gap: $spacing-xl;
}

.report-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: $spacing-lg;
}

// KPI Cards
.kpi-card {
  padding: $spacing-xl;
  border-radius: $radius-lg;
  border: var(--ui-border-width) solid $border-primary;
  background: $bg-secondary;
  display: flex;
  flex-direction: column;
  gap: $spacing-sm;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;

  &:hover {
    transform: translateY(-4px);
    box-shadow: $shadow-lg;
  }

  // Accent Borders
  &::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 4px;
  }

  &.accent-blue::before { background: $accent-primary; }
  &.accent-red::before { background: var(--color-error); }
  &.accent-green::before { background: var(--color-success); }
  &.accent-orange::before { background: var(--color-warning); }

  .kpi-header {
    display: flex;
    align-items: center;
    gap: $spacing-sm;
    color: $text-secondary;
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: var(--font-weight-semibold);
    
    i { font-size: 1.1rem; opacity: 0.7; }
  }

  .kpi-value {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: $text-primary;
    font-family: $font-mono;
  }
}

// Document Sheet
.document-sheet {
  background: $bg-secondary;
  border: var(--ui-border-width) solid $border-primary;
  border-radius: $radius-lg;
  box-shadow: $shadow-lg;
  max-width: 960px;
  margin: 0 auto;
  padding: $spacing-3xl $spacing-4xl;
  
  @media (max-width: 768px) { padding: $spacing-xl; }

  .sheet-header {
    text-align: center;
    margin-bottom: $spacing-3xl;
    padding-bottom: $spacing-2xl;
    border-bottom: 2px solid $border-secondary;

    h2 { 
      font-family: $font-heading;
      font-size: var(--font-size-3xl);
      color: $text-primary;
      margin: 0 0 $spacing-xs 0; 
    }
    p { 
      font-family: $font-mono;
      color: $text-secondary;
      font-size: var(--font-size-sm);
    }
  }

  .sheet-section {
    width: 100%;
  }

  .line-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: $spacing-md 0;
    border-bottom: 1px dashed $border-secondary;
    font-size: var(--font-size-md);
    color: $text-secondary;

    span:last-child {
      font-family: $font-mono;
      font-weight: var(--font-weight-medium);
      color: $text-primary;
    }

    &.header {
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      font-size: var(--font-size-xs);
      color: $text-tertiary;
      border-bottom: 2px solid $border-primary;
      margin-bottom: $spacing-lg;
    }

    &.total {
      border-top: 2px solid $text-primary;
      border-bottom: none;
      margin-top: $spacing-xl;
      padding-top: $spacing-xl;
      
      span { 
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
        color: $text-primary;
      }
    }
  }
  
  .sheet-column {
    h3 {
      font-size: var(--font-size-lg);
      color: $accent-primary;
      margin-bottom: $spacing-lg;
      font-weight: var(--font-weight-semibold);
    }
  }
}

// --- PRIME NG OVERRIDES (The "Upgraded" Parts) ---
:host ::ng-deep {
  // Inputs
  .glass-input {
    .p-inputtext, .p-select {
      background: rgba(255,255,255,0.6);
      border: var(--ui-border-width) solid $border-primary;
      border-radius: $radius-base;
      color: $text-primary;
      transition: var(--transition-fast);
      font-family: $font-body;
      font-size: var(--font-size-base);
      
      &:hover { border-color: $accent-primary; background: rgba(255,255,255,0.8); }
      &:focus, &.p-focus { 
        border-color: $accent-primary; 
        box-shadow: 0 0 0 var(--focus-ring-width) $accent-focus;
        background: #ffffff;
      }
    }
  }

  .glass-input-sm {
    @extend .glass-input;
    .p-inputtext { padding: 0.4rem 0.6rem; font-size: var(--font-size-sm); }
    .p-select { height: 38px; align-items: center; }
  }

  // Buttons
  .glass-btn {
    background: transparent;
    border: var(--ui-border-width) solid $border-secondary;
    color: $text-secondary;
    border-radius: $radius-base;
    transition: var(--transition-fast);
    font-weight: var(--font-weight-medium);

    &:hover {
      background: var(--component-bg-hover);
      color: $accent-primary;
      border-color: $accent-primary;
    }
  }

  .glass-btn-primary {
    background: $accent-primary;
    border: var(--ui-border-width) solid $accent-primary;
    color: white;
    
    &:hover {
      background: $accent-hover;
      border-color: $accent-hover;
    }
  }

  // Tabs
  .glass-tabs {
    .p-tablist-tab-list {
      background: transparent !important;
      border: none !important;
    }
    
    .p-tab {
      background: transparent;
      border: none;
      color: $text-secondary;
      font-weight: var(--font-weight-medium);
      padding: $spacing-md $spacing-xl;
      transition: var(--transition-base);
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      font-family: $font-body;

      &:hover {
        color: $text-primary;
        background: var(--component-bg-hover);
        border-radius: $radius-base $radius-base 0 0;
      }

      &.p-tab-active {
        color: $accent-primary;
        border-bottom-color: $accent-primary;
        background: linear-gradient(to top, var(--component-bg-active) 0%, transparent 100%);
      }
    }
  }

  // Dialogs
  .glass-dialog {
    .p-dialog-header {
      background: $bg-secondary;
      border-bottom: var(--ui-border-width) solid $border-primary;
      padding: $spacing-lg;
      
      .p-dialog-title { 
        font-weight: var(--font-weight-semibold);
        color: $text-primary; 
        font-family: $font-heading;
      }
    }
    .p-dialog-content {
      background: $bg-secondary;
      padding: $spacing-xl;
    }
    .p-dialog-footer {
      background: $bg-secondary;
      border-top: var(--ui-border-width) solid $border-primary;
      padding: $spacing-lg;
    }
  }
  
  // Datepicker styling fix
  .p-datepicker-input {
    width: 100%;
  }
}

// Text Utilities
.text-error { color: var(--color-error) !important; }
.text-success { color: var(--color-success) !important; }
.text-secondary { color: $text-secondary !important; }