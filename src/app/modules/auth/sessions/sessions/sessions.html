<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="list-page-container">

  <div class="list-header">
    <div class="title-section">
      <div class="icon-box">
        <i class="pi pi-shield"></i>
      </div>
      <div class="text-content">
        <h2 class="list-title">Session Management</h2>
        <p class="list-subtitle">Monitor and control active sessions across all devices.</p>
      </div>
    </div>

    <div class="actions-section">
      <div class="p-buttongroup mode-toggle">
        <button pButton label="All Sessions" [ngClass]="viewMode() === 'all' ? 'active-mode' : 'p-button-text'"
          (click)="toggleViewMode('all')"></button>
        <button pButton label="My Sessions" [ngClass]="viewMode() === 'mine' ? 'active-mode' : 'p-button-text'"
          (click)="toggleViewMode('mine')"></button>
      </div>

      <button pButton label="Revoke Others" icon="pi pi-ban" class="p-button-warning p-button-outlined"
        (click)="revokeAllOthers()" pTooltip="Log out from all other devices">
      </button>
    </div>
  </div>

  <div class="glass-panel">
    <app-ag-share-grid [columns]="column" [data]="data" [showActions]="false" selectionMode="multiple"
      (gridEvent)="eventFromGrid($event)" style="height: 100%; width: 100%; display: block;">
    </app-ag-share-grid>
  </div>

</div>

<p-dialog header="Session Details" [(visible)]="displayDialog" [modal]="true" styleClass="glass-dialog"
  [draggable]="false" [resizable]="false">

  @if (selectedSession) {
  <div class="session-details-form">

    <div class="status-banner" [class.active]="selectedSession.isValid" [class.revoked]="!selectedSession.isValid">
      <i class="pi" [class]="selectedSession.isValid ? 'pi-check-circle' : 'pi-times-circle'"></i>
      <div class="banner-text">
        <strong>{{ selectedSession.isValid ? 'Active Session' : 'Revoked Session' }}</strong>
        <span>{{ selectedSession.isValid ? 'This session allows access to the system.' : 'Access has been terminated for
          this session.' }}</span>
      </div>
    </div>

    <div class="detail-grid">

      <div class="detail-group full-width" *ngIf="selectedSession.userId">
        <label>User Account</label>
        <div class="value-box user-box">
          <div class="user-avatar-small">
            {{ selectedSession.userId.name.charAt(0).toUpperCase() }}
          </div>
          <div class="flex flex-col">
            <span class="font-bold">{{ selectedSession.userId.name }}</span>
            <span class="text-xs text-secondary">{{ selectedSession.userId.email }}</span>
          </div>
        </div>
      </div>

      <div class="detail-group full-width">
        <label>Device / Browser</label>
        <div class="value-box">
          <i class="pi pi-globe text-accent"></i>
          <span class="simple-value">{{ selectedSession.browser }} <span class="text-tertiary">on</span> {{
            selectedSession.os }}</span>
        </div>
      </div>

      <div class="detail-group">
        <label>IP Address</label>
        <div class="value-box">
          <i class="pi pi-map-marker text-accent"></i>
          <span class="simple-value font-mono">{{ selectedSession.ipAddress }}</span>
        </div>
      </div>

      <div class="detail-group">
        <label>Logged In</label>
        <div class="value-box">
          <i class="pi pi-calendar text-accent"></i>
          <span class="simple-value">{{ common.formatDate(selectedSession.loggedInAt, 'medium') }}</span>
        </div>
      </div>

      <div class="detail-group full-width">
        <label>Last Activity</label>
        <div class="value-box">
          <i class="pi pi-clock text-accent"></i>
          <span class="simple-value">{{ common.formatDate(selectedSession.lastActivityAt, 'medium') }}</span>
        </div>
      </div>

      <div class="detail-group full-width">
        <label>User Agent String</label>
        <div class="code-block">
          {{ selectedSession.userAgent }}
        </div>
      </div>

    </div>
  </div>

  <div class="dialog-footer">
    <button pButton label="Close" class="p-button-text p-button-secondary" (click)="displayDialog = false"></button>
    <div class="right-actions">
      <button pButton label="Delete" icon="pi pi-trash" class="p-button-outlined p-button-danger"
        [loading]="isDeleting()" (click)="deleteSession()"></button>
      @if (selectedSession.isValid) {
      <button pButton label="Revoke Access" icon="pi pi-power-off" class="p-button-danger" [loading]="isRevoking()"
        (click)="revokeSession()"></button>
      }
    </div>
  </div>
  }
</p-dialog>