<div class="timeline-wrapper">
  
  <div class="timeline-header">
    <div class="month-navigator">
      <button pButton icon="pi pi-chevron-left" class="p-button-text p-button-rounded p-button-sm nav-btn" 
              (click)="changeMonth(-1)"></button>
      
      <span class="current-month">{{ currentMonthName() }}</span>
      
      <button pButton icon="pi pi-chevron-right" class="p-button-text p-button-rounded p-button-sm nav-btn" 
              (click)="changeMonth(1)"></button>
    </div>

    <button *ngIf="!isCurrentMonth()" pButton label="Jump to Today" class="p-button-text p-button-sm today-btn" 
            (click)="jumpToToday()"></button>
  </div>

  <div class="timeline-strip" #scrollContainer>
    
    @if (isLoading()) {
      <div class="day-card-skeleton-wrapper">
        @for (i of [1,2,3,4,5,6,7,8,9,10,11,12]; track i) {
          <div class="day-card-skeleton">
            <p-skeleton width="30px" height="10px" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="20px" height="20px"></p-skeleton>
          </div>
        }
      </div>
    } @else {
      @for (day of timelineDays(); track day.date) {
        <div 
          class="day-card" 
          [class.active]="isSameDate(day.date, selectedDate())"
          [class.today]="isToday(day.date)"
          [class.intensity-1]="day.intensity === 1"
          [class.intensity-2]="day.intensity === 2"
          [class.intensity-3]="day.intensity === 3"
          (click)="selectDate(day.date)"
          [pTooltip]="getTooltipText(day)" 
          tooltipPosition="top"
          [tooltipStyleClass]="'text-xs'">
          
          <span class="day-name">{{ day.dayName }}</span>
          <span class="day-num">{{ day.dayNum }}</span>

          <div class="activity-bar">
             @if (day.count > 0) {
                @for (i of getDotArray(day.count); track i) {
                  <div class="note-pill"></div>
                }
                @if (day.count > 3) {
                   <div class="note-pill-overflow">+</div>
                }
             }
          </div>
        </div>
      }
    }
  </div>
</div>
