<div class="finance-grid">
  
  <!-- 1. PROFITABILITY & MARGINS -->
  <div class="finance-card glass-panel main-stats">
    <div class="card-header">
      <h3>Profitability & Margins</h3>
      <span class="badge" [ngClass]="marginPercent >= 0 ? 'success' : 'danger'">
        {{ marginPercent | number:'1.2-2' }}% Margin
      </span>
    </div>
    
    <div class="stats-row">
      <div class="stat-item">
        <span class="label">Total Revenue</span>
        <span class="value">{{ profitability?.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
      </div>
      <div class="stat-item">
        <span class="label">COGS</span>
        <span class="value danger-text">{{ profitability?.totalCOGS | currency:'INR':'symbol':'1.0-0' }}</span>
      </div>
      <div class="stat-item">
        <span class="label">Gross Profit</span>
        <span class="value success-text">{{ profitability?.grossProfit | currency:'INR':'symbol':'1.0-0' }}</span>
      </div>
    </div>

    <!-- Simple Progress Bar for Margin -->
    <div class="progress-bar-container">
      <div class="progress-bar" [style.width.%]="marginPercent > 100 ? 100 : (marginPercent < 0 ? 0 : marginPercent)"></div>
    </div>
  </div>

  <!-- 2. TAX SUMMARY -->
  <div class="finance-card glass-panel">
    <div class="card-header">
      <h3>Tax Overview (GST)</h3>
    </div>
    <div class="tax-grid">
      <div class="tax-row">
        <span>Input Tax (Credit)</span>
        <span class="val success-text">+ {{ tax?.inputTax | currency:'INR':'symbol':'1.0-0' }}</span>
      </div>
      <div class="tax-row">
        <span>Output Tax (Liability)</span>
        <span class="val danger-text">- {{ tax?.outputTax | currency:'INR':'symbol':'1.0-0' }}</span>
      </div>
      <div class="divider"></div>
      <div class="tax-row total">
        <span>Net Payable</span>
        <span class="val" [ngClass]="(tax?.netPayable || 0) > 0 ? 'danger-text' : 'success-text'">
          {{ tax?.netPayable | currency:'INR':'symbol':'1.0-0' }}
        </span>
      </div>
    </div>
  </div>

  <!-- 3. CASH FLOW (Payment Modes) -->
  <div class="finance-card glass-panel" *ngIf="paymentChartData?.values?.length">
    <div class="card-header">
      <h3>Incoming Cash Flow</h3>
    </div>
    <div class="chart-wrapper">
      <payment-donut [data]="paymentChartData"></payment-donut>
    </div>
  </div>

  <!-- 4. AGING REPORT (Receivables) -->
  <div class="finance-card glass-panel aging-panel" *ngIf="agingReport?.length">
    <div class="card-header">
      <h3>Aging Report (Receivables)</h3>
    </div>
    <div class="aging-list">
      <div class="aging-item" *ngFor="let item of agingReport">
        <div class="aging-info">
          <span class="range">{{ item.range || '0-30 Days' }}</span>
          <span class="count">{{ item.count }} Invoices</span>
        </div>
        <span class="amount">{{ item.totalAmount | currency:'INR':'symbol':'1.0-0' }}</span>
      </div>
    </div>
  </div>

</div>