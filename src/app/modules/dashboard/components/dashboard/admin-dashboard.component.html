<div class="dashboard-container animate-fadeIn">
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="page-title">Executive Overview</h1>
      <p class="page-subtitle">
        Snapshot of your sales, cashflow and risk.
      </p>
    </div>

    <div class="header-actions">
      
      <div class="header-filters">
        <div class="preset-group">
          <button class="filter-chip" [class.active]="activePreset() === 'all'" (click)="applyPreset('all')">
            All time
          </button>
          <button class="filter-chip" [class.active]="activePreset() === 'month'" (click)="applyPreset('month')">
            This month
          </button>
        </div>

        <div class="date-range-wrapper">
          <p-datepicker selectionMode="range" [showIcon]="true" [maxDate]="today" dateFormat="yy-mm-dd"
            [(ngModel)]="dateRangeModel" (onSelect)="onDateRangeChange()" appendTo="body"
            styleClass="w-full" inputStyleClass="w-full"
            placeholder="Custom Range"
            inputId="dashboardDateRange"></p-datepicker>
        </div>
      </div>

      <div class="action-buttons">
        <p-button label="Download" icon="pi pi-download" styleClass="p-button-outlined p-button-sm w-full"></p-button>
        <p-button label="Refresh" icon="pi pi-refresh" (onClick)="loadDashboard()" [loading]="loading()" styleClass="p-button-sm w-full"></p-button>
      </div>
    </div>
  </header>

  @if (loading()) {
    <div class="grid-layout">
      <p-skeleton height="8rem" borderRadius="10px" styleClass="w-full"></p-skeleton>
      <p-skeleton height="8rem" borderRadius="10px" styleClass="w-full"></p-skeleton>
    </div>
  } @else {

  <section class="grid-layout kpi-section">
    <div class="glass-card kpi-card">
      <div class="kpi-top">
        <div class="icon-wrapper accent-wrapper"><i class="pi pi-wallet"></i></div>
        <span class="trend-badge positive"><i class="pi pi-arrow-up"></i> This period</span>
      </div>
      <div class="kpi-content">
        <span class="kpi-label">Total Revenue</span>
        <h3 class="kpi-value">{{ common.formatCurrency(totalSales()) }}</h3>
        <p class="kpi-sub">Income: {{ common.formatCurrency(income()) }}</p>
      </div>
    </div>
    
    </section>

  <section class="main-content-grid">
    <div class="glass-card chart-section">
      <div class="card-header">
        <div>
          <h3>Revenue Trend</h3>
          <span class="text-xs text-secondary">Last 6 months</span>
        </div>
      </div>
      <div class="chart-wrapper">
        <p-chart type="bar" [data]="chartData()" [options]="chartOptions()" height="100%"></p-chart>
      </div>
    </div>

    <div class="glass-card rankings-section">
      <div class="card-header card-header--split">
        <h3>Rankings</h3>
        <div class="ranking-tabs">
          <button class="ranking-tab" [class.active]="activeRankingTab() === 'products'" (click)="setRankingTab('products')">Products</button>
          <button class="ranking-tab" [class.active]="activeRankingTab() === 'customers'" (click)="setRankingTab('customers')">Customers</button>
        </div>
      </div>

      <div class="table-responsive-wrapper">
        <p-table [value]="activeRankingTab() === 'products' ? topProducts() : topCustomers()" styleClass="p-datatable-sm">
            </p-table>
      </div>
    </div>
  </section>

  <section class="glass-card mt-md receivables-section">
    <div class="card-header receivables-header">
      <h3>Outstanding</h3>
      <div class="receivables-summary hidden-xs"> <span class="badge-pill badge-danger"><i class="pi pi-exclamation-triangle"></i> Action Needed</span>
      </div>
    </div>
    
    <div class="table-responsive-wrapper">
      <p-table [value]="receivables()" styleClass="p-datatable-sm">
         </p-table>
    </div>
  </section>
  }
</div>
