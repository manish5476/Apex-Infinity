<div class="dashboard-container">
  
  <!-- 1. HEADER & CONTROLS -->
  <header class="dashboard-header glass-panel">
    <div class="header-content">
      <h1>Executive Dashboard</h1>
      <p class="subtitle">Real-time performance snapshot â€” revenue, risk, and operational growth.</p>
    </div>

    <div class="header-actions">
      <!-- Section Tabs -->
      <div class="toggle-group nav-tabs">
        <button 
          class="toggle-btn" 
          [class.active]="activeTab() === 'overview'" 
          (click)="activeTab.set('overview')">
          Overview
        </button>
        <button 
          class="toggle-btn" 
          [class.active]="activeTab() === 'finance'" 
          (click)="activeTab.set('finance')">
          Finance
        </button>
      </div>

      <div class="separator"></div>

      <!-- Date Presets -->
      <div class="toggle-group">
        <button 
          class="toggle-btn" 
          [class.active]="activePreset() === 'all'" 
          (click)="applyPreset('all')">
          All
        </button>
        <button 
          class="toggle-btn" 
          [class.active]="activePreset() === 'month'" 
          (click)="applyPreset('month')">
          Month
        </button>
      </div>

      <!-- Date Picker -->
      <div class="date-picker-wrapper">
        <p-datepicker 
          [(ngModel)]="dateRangeModel" 
          selectionMode="range" 
          [readonlyInput]="true"
          placeholder="Custom Range"
          inputStyleClass="glass-input" 
          panelStyleClass="glass-datepicker-panel"
          (onSelect)="onDateChange()">
        </p-datepicker>
        <i class="pi pi-calendar calendar-icon"></i>
      </div>

      <!-- Refresh -->
      <button class="icon-btn glass-btn" (click)="facade.load()" [disabled]="facade.loading()">
        <i class="pi pi-refresh" [class.spin]="facade.loading()"></i>
      </button>
    </div>
  </header>

  <!-- 2. LOADING STATE -->
  <div *ngIf="facade.loading() && !facade.kpi()" class="loading-overlay">
    <div class="spinner"></div>
    <span>Gathering Insights...</span>
  </div>

  <!-- 3. VIEW: OVERVIEW -->
  <ng-container *ngIf="activeTab() === 'overview'">
    <dashboard-overview
      *ngIf="!facade.loading() || facade.kpi()"
      [kpi]="facade.kpi()"
      [timeline]="facade.timelineChart()"
      [paymentModes]="facade.paymentModes()"
      [leaders]="facade.leaders()"
      [inventory]="facade.inventory()">
    </dashboard-overview>

    <section class="branch-section">
      <div class="glass-panel full-width">
        <div class="card-header">
          <h3>Branch Performance Comparison</h3>
        </div>
        <branch-comparison [data]="facade.branchComparison()"></branch-comparison>
      </div>
    </section>

    <section class="extra-insights-grid">
      <div class="mini-panel glass-panel warning-border">
        <risk-panel [risk]="facade.risk()"></risk-panel>
      </div>
      <div class="mini-panel glass-panel">
        <segmentation-chart [segmentation]="facade.segmentation()"></segmentation-chart>
      </div>
    </section>
  </ng-container>

  <!-- 4. VIEW: FINANCE (New Section) -->
  <ng-container *ngIf="activeTab() === 'finance'">
    <finance-overview
      [profitability]="facade.branchComparison()"
      [paymentChartData]="facade.paymentModes()"
      [agingReport]="facade.debtorAging()"
      [tax]="facade.tax()">
    </finance-overview>
  </ng-container>

</div>