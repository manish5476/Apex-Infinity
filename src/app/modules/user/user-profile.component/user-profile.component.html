@if (currentUser(); as user) {
  <div class="profile-wrapper fade-in">
    
    <div class="hero-card">
      <div class="hero-cover"></div>
      
      <div class="hero-content">
        <div class="avatar-wrapper">
          
          <div class="avatar-circle">
            @if (user.avatar) {
              <img [src]="user.avatar" [alt]="user.name" class="profile-image">
            } @else {
              {{ getInitials(user.name) }}
            }
          </div>

          <div class="status-indicator" [class.active]="user.isActive"></div>

          <button class="upload-btn" (click)="triggerFileInput()" [disabled]="uploading()">
            @if (uploading()) {
              <div class="spinner"></div> } @else {
              <span class="upload-icon">üì∏</span>
            }
          </button>

          <input 
            type="file" 
            #fileInput 
            (change)="onFileSelected($event)" 
            accept="image/*" 
            style="display: none;">

        </div>

        <div class="identity-section">
          <div class="name-block">
            <h1 class="user-name">{{ user.name }}</h1>
            <p class="user-role">{{ user.role.name }} ‚Ä¢ {{ user.organizationId }}</p>
          </div>
          
          <div class="action-buttons">
             <div class="id-badge">
              <span class="label">UID</span>
              <span class="value">{{ user._id | slice:0:8 }}...</span>
            </div>
            <button class="btn btn-primary">Edit Profile</button>
            <button class="btn btn-secondary">Activity Log</button>
          </div>
        </div>
      </div>
    </div>
    
    @if (uploadError(); as error) {
      <div class="alert-error">{{ error }}</div>
    }

    <div class="content-grid">
      
      <aside class="side-column">
        
        <section class="card detail-card">
          <h3 class="section-heading">Contact Info</h3>
          <ul class="info-list">
            <li class="info-item">
              <span class="icon">üìß</span>
              <div class="info-data">
                <span class="label">Email</span>
                <span class="value">{{ user.email }}</span>
              </div>
            </li>
            <li class="info-item">
              <span class="icon">üìÖ</span>
              <div class="info-data">
                <span class="label">Joined</span>
                <span class="value">{{ user.createdAt | date:'mediumDate' }}</span>
              </div>
            </li>
          </ul>
        </section>

        @if (user.branchId; as branch) {
          <section class="card detail-card branch-card">
            <h3 class="section-heading">Location</h3>
            <div class="location-preview">
              <div class="map-placeholder">
                <span class="map-icon">üìç</span>
              </div>
              <div class="location-details">
                <h4>{{ branch.name | titlecase }}</h4>
                <p>{{ branch.address.city }}, {{ branch.address.country }}</p>
              </div>
            </div>
          </section>
        }

        <section class="card detail-card">
          <h3 class="section-heading">Preferences</h3>
          <div class="pref-toggles">
            <div class="toggle-row">
              <span>Dark Mode</span>
              <div class="pill-toggle" [class.on]="user.preferences.theme === 'dark'"></div>
            </div>
            <div class="toggle-row">
              <span>Dense Mode</span>
              <div class="pill-toggle" [class.on]="user.preferences.denseMode"></div>
            </div>
            <div class="notification-pills">
              <span class="pill" [class.active]="user.preferences.notifications.email">Email</span>
              <span class="pill" [class.active]="user.preferences.notifications.push">Push</span>
              <span class="pill" [class.active]="user.preferences.notifications.sms">SMS</span>
            </div>
          </div>
        </section>
      </aside>

      <main class="main-column">
        
        <section class="card large-card">
          <div class="card-header">
            <h3 class="section-heading">Permissions & Access Control</h3>
            <span class="counter">{{ user.role.permissions.length }}</span>
          </div>
          
          <div class="permissions-grid">
            @for (perm of user.role.permissions; track perm) {
              <div class="permission-chip">
                <span class="check">‚úì</span>
                {{ formatPermission(perm) }}
              </div>
            }
          </div>
        </section>

        <section class="card large-card">
          <h3 class="section-heading">System Metadata</h3>
          <div class="meta-grid">
            <div class="meta-box">
              <span class="label">Last Updated</span>
              <span class="val">{{ user.updatedAt | date:'medium' }}</span>
            </div>
            <div class="meta-box">
              <span class="label">Status</span>
              <span class="val status-text" [class.active]="user.isActive">
                {{ user.isActive ? 'Operational' : 'Suspended' }}
              </span>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>
} @else {
  <div class="loading-skeleton">Loading...</div>
}

<!-- @if (userSignal(); as user) {
<div class="profile-wrapper fade-in">

  <div class="hero-card">
    <div class="hero-cover"></div>

    <div class="hero-content">
      <div class="avatar-wrapper">
        <div class="avatar-circle">
          {{ getInitials(user.name) }}
        </div>
        <div class="status-indicator" [class.active]="user.isActive"></div>
      </div>

      <div class="identity-section">
        <div class="name-block">
          <h1 class="user-name">{{ user.name }}</h1>
          <p class="user-role">{{ user.role.name }} ‚Ä¢ {{ user.organizationId }}</p>
        </div>

        <div class="action-buttons">
          <div class="id-badge">
            <span class="label">UID</span>
            <span class="value">{{ user._id | slice:0:8 }}...</span>
          </div>
          <button class="btn btn-primary">Edit Profile</button>
          <button class="btn btn-secondary">Activity Log</button>
        </div>
      </div>
    </div>
  </div>

  <div class="content-grid">

    <aside class="side-column">

      <section class="card detail-card">
        <h3 class="section-heading">Contact Info</h3>
        <ul class="info-list">
          <li class="info-item">
            <span class="icon">üìß</span>
            <div class="info-data">
              <span class="label">Email</span>
              <span class="value">{{ user.email }}</span>
            </div>
          </li>
          <li class="info-item">
            <span class="icon">üìÖ</span>
            <div class="info-data">
              <span class="label">Joined</span>
              <span class="value">{{ user.createdAt | date:'mediumDate' }}</span>
            </div>
          </li>
        </ul>
      </section>

      @if (user.branchId; as branch) {
      <section class="card detail-card branch-card">
        <h3 class="section-heading">Location</h3>
        <div class="location-preview">
          <div class="map-placeholder">
            <span class="map-icon">üìç</span>
          </div>
          <div class="location-details">
            <h4>{{ branch.name | titlecase }}</h4>
            <p>{{ branch.address.city }}, {{ branch.address.country }}</p>
          </div>
        </div>
      </section>
      }

      <section class="card detail-card">
        <h3 class="section-heading">Preferences</h3>
        <div class="pref-toggles">
          <div class="toggle-row">
            <span>Dark Mode</span>
            <div class="pill-toggle" [class.on]="user.preferences.theme === 'dark'"></div>
          </div>
          <div class="toggle-row">
            <span>Dense Mode</span>
            <div class="pill-toggle" [class.on]="user.preferences.denseMode"></div>
          </div>
          <div class="notification-pills">
            <span class="pill" [class.active]="user.preferences.notifications.email">Email</span>
            <span class="pill" [class.active]="user.preferences.notifications.push">Push</span>
            <span class="pill" [class.active]="user.preferences.notifications.sms">SMS</span>
          </div>
        </div>
      </section>
    </aside>

    <main class="main-column">

      <section class="card large-card">
        <div class="card-header">
          <h3 class="section-heading">Permissions & Access Control</h3>
          <span class="counter">{{ user.role.permissions.length }}</span>
        </div>

        <div class="permissions-grid">
          @for (perm of user.role.permissions; track perm) {
          <div class="permission-chip">
            <span class="check">‚úì</span>
            {{ formatPermission(perm) }}
          </div>
          }
        </div>
      </section>

      <section class="card large-card">
        <h3 class="section-heading">System Metadata</h3>
        <div class="meta-grid">
          <div class="meta-box">
            <span class="label">Last Updated</span>
            <span class="val">{{ user.updatedAt | date:'medium' }}</span>
          </div>
          <div class="meta-box">
            <span class="label">Status</span>
            <span class="val status-text" [class.active]="user.isActive">
              {{ user.isActive ? 'Operational' : 'Suspended' }}
            </span>
          </div>
        </div>
      </section>

    </main>
  </div>
</div>
} @else {
<div class="loading-skeleton">Loading...</div>
} -->

<!-- @if (userSignal(); as user) {
  <div class="profile-container fade-in">
    
    <header class="profile-header">
      <div class="user-identity">
        <div class="avatar-circle">
          {{ getInitials(user.name) }}
        </div>
        <div class="user-meta">
          <h1 class="user-name">{{ user.name }}</h1>
          <div class="badges-row">
            <span class="badge role-badge">{{ user.role.name }}</span>
            <span class="badge status-badge" [class.active]="user.isActive">
              {{ user.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="header-actions">
        <div class="id-pill">
          <span class="label">User ID</span>
          <span class="value">{{ user._id }}</span>
        </div>
      </div>
    </header>

    <div class="profile-grid">
      
      <div class="column-main">
        
        <section class="card glass-panel">
          <h2 class="card-title">Contact Information</h2>
          <div class="info-row">
            <label>Email Address</label>
            <div class="value-container">
              <span class="text-value">{{ user.email }}</span>
              <span class="verified-icon" title="Verified">‚úì</span>
            </div>
          </div>
          <div class="info-row">
            <label>Joined Date</label>
            <span class="text-value">{{ user.createdAt | date:'mediumDate' }}</span>
          </div>
        </section>

        @if (user.branchId; as branch) {
          <section class="card glass-panel">
            <h2 class="card-title">Branch Assignment</h2>
            <div class="branch-highlight">
              <div class="branch-icon">üè¢</div>
              <div class="branch-info">
                <h3>{{ branch.name | titlecase }}</h3>
                <address>
                  {{ branch.address.street }}<br>
                  {{ branch.address.city }}, {{ branch.address.state }} {{ branch.address.zipCode }}<br>
                  {{ branch.address.country }}
                </address>
              </div>
            </div>
          </section>
        }

        <section class="card glass-panel">
          <h2 class="card-title">System Preferences</h2>
          <div class="pref-grid">
            <div class="pref-item">
              <span class="pref-label">Theme</span>
              <span class="pref-value">{{ user.preferences.theme | titlecase }}</span>
            </div>
            <div class="pref-item">
              <span class="pref-label">Dense Mode</span>
              <span class="pref-value">{{ user.preferences.denseMode ? 'On' : 'Off' }}</span>
            </div>
            <div class="pref-item full-width">
              <span class="pref-label">Notifications</span>
              <div class="toggle-display">
                <span [class.enabled]="user.preferences.notifications.email">Email</span>
                <span [class.enabled]="user.preferences.notifications.push">Push</span>
                <span [class.enabled]="user.preferences.notifications.sms">SMS</span>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div class="column-side">
        
        <section class="card glass-panel permissions-card">
          <div class="card-header-row">
            <h2 class="card-title">Permissions & Access</h2>
            <span class="count-badge">{{ user.role.permissions.length }}</span>
          </div>
          
          <div class="permissions-list custom-scroll">
            @for (perm of user.role.permissions; track perm) {
              <div class="perm-tag">
                <span class="check-icon">üõ°Ô∏è</span>
                {{ formatPermission(perm) }}
              </div>
            }
          </div>
        </section>

        <section class="card glass-panel metadata-card">
          <h2 class="card-title">Metadata</h2>
          <div class="meta-row">
            <span>Organization ID</span>
            <code>{{ user.organizationId }}</code>
          </div>
          <div class="meta-row">
            <span>Last Updated</span>
            <span>{{ user.updatedAt | date:'short' }}</span>
          </div>
        </section>
      </div>

    </div>
  </div>
} @else {
  <div class="loading-state">
    Loading profile...
  </div>
} -->