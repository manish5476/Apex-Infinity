<div class="dashboard-container animate-fadeInDown">

  @if (!loading() && customer(); as c) {

  <header class="dashboard-header">
    <div class="header-left">
      <p-button icon="pi pi-arrow-left" styleClass="p-button-text p-button-rounded back-btn" routerLink="/customer"></p-button>
      
      <div class="customer-identity">
        <div class="name-row">
          <h1>{{ c.name }}</h1>
          <p-tag [value]="c.isActive ? 'Active' : 'Inactive'" [severity]="c.isActive ? 'success' : 'danger'" styleClass="text-xs font-bold"></p-tag>
        </div>
        <div class="badges">
          <span class="id-pill">
            <i class="pi pi-hashtag text-xs mr-1"></i>
            {{ c.code || c._id.substring(c._id.length - 6).toUpperCase() }}
          </span>
          <span class="type-label">{{ c.type }} CUSTOMER</span>
        </div>
      </div>
    </div>

    <div class="header-actions">
      <p-button label="Edit Profile" icon="pi pi-user-edit" styleClass="p-button-outlined p-button-secondary p-button-sm"
        [routerLink]="['../../customer/create']" [queryParams]="{id: c._id}"></p-button>
      <p-button label="New Invoice" icon="pi pi-plus" styleClass="p-button-primary p-button-sm" routerLink="/invoices/create"
        [queryParams]="{customerId: c._id}"></p-button>
    </div>
  </header>

  <div class="layout-grid animate-fadeInUp" style="animation-delay: 0.1s;">

    <aside class="profile-card">
      <div class="card-banner"></div>
      
      <div class="identity-section">
        <div class="avatar-wrapper">
          <p-avatar [image]="c.avatar" [label]="common.getInitials(c.name)" size="xlarge" shape="circle"
            styleClass="user-avatar"></p-avatar>
          <div class="status-indicator" [class.active]="c.isActive"></div>
        </div>
        <h3>{{ c.contactPerson || c.name }}</h3>
        <span class="email">{{ c.email }}</span>
      </div>

      <div class="details-list">
        <div class="detail-item">
          <div class="icon-circle"><i class="pi pi-phone"></i></div>
          <div class="meta">
            <label>Phone</label>
            <span>{{ c.phone }}</span>
          </div>
        </div>
        <div class="detail-item">
          <div class="icon-circle"><i class="pi pi-id-card"></i></div>
          <div class="meta">
            <label>GST Number</label>
            <span class="font-mono">{{ c.gstNumber || 'N/A' }}</span>
          </div>
        </div>
        <div class="detail-item">
          <div class="icon-circle"><i class="pi pi-map-marker"></i></div>
          <div class="meta">
            <label>Billing Address</label>
            <span>
              {{ c.billingAddress?.city || 'City' }}, {{ c.billingAddress?.state || 'State' }}
            </span>
            <span class="text-muted text-xs">{{ c.billingAddress?.street }}</span>
          </div>
        </div>
      </div>
    </aside>

    <main class="right-content">
      
      <section class="metrics-grid">
        <div class="metric-card outstanding">
          <div class="icon-box"><i class="pi pi-wallet"></i></div>
          <div class="data-box">
            <label>Outstanding</label>
            <span class="value">{{ common.formatCurrency(closingBalance()) }}</span>
          </div>
        </div>
        <div class="metric-card invoiced">
          <div class="icon-box"><i class="pi pi-receipt"></i></div>
          <div class="data-box">
            <label>Total Invoiced</label>
            <span class="value">{{ common.formatCurrency(totalInvoiced()) }}</span>
          </div>
        </div>
        <div class="metric-card received">
          <div class="icon-box"><i class="pi pi-check-circle"></i></div>
          <div class="data-box">
            <label>Total Received</label>
            <span class="value">{{ common.formatCurrency(totalPaid()) }}</span>
          </div>
        </div>
        <div class="metric-card limit">
          <div class="icon-box"><i class="pi pi-shield"></i></div>
          <div class="data-box">
            <label>Credit Limit</label>
            <span class="value">{{ common.formatCurrency(c.creditLimit) }}</span>
          </div>
        </div>
      </section>

      <div class="activity-panel">
        <p-tabs value="0">
          <p-tablist>
            <p-tab value="0"><i class="pi pi-list mr-2"></i> Ledger</p-tab>
            <p-tab value="1"><i class="pi pi-file mr-2"></i> Invoices</p-tab>
            <p-tab value="2"><i class="pi pi-wallet mr-2"></i> Payments</p-tab>
          </p-tablist>
  
          <p-tabpanels>
            <p-tabpanel value="0">
              <p-table [value]="ledgerHistory()" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Type</th>
                    <th class="text-right">Amount</th>
                    <th class="text-right">Balance</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-row>
                  <tr>
                    <td class="font-mono text-xs">{{ common.formatDate(row.date) }}</td>
                    <td class="font-medium">{{ row.description }}</td>
                    <td><span class="status-badge" [class.success]="row.type === 'credit'" [class.danger]="row.type === 'debit'">{{ row.type }}</span></td>
                    <td class="text-right font-bold" [style.color]="row.type === 'credit' ? 'var(--color-success)' : 'var(--color-error)'">{{ common.formatCurrency(row.amount) }}</td>
                    <td class="text-right font-bold text-secondary">{{ common.formatCurrency(row.balance) }}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage"><tr><td colspan="5">No transactions found.</td></tr></ng-template>
              </p-table>
            </p-tabpanel>
  
            <p-tabpanel value="1">
              <p-table [value]="invoices()" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Invoice #</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th class="text-right">Total</th>
                    <th class="text-right">Due</th>
                    <th class="text-center">Actions</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-inv>
                  <tr>
                    <td class="font-bold cursor-pointer" style="color: var(--accent-primary)" [routerLink]="['/invoices', inv._id]">{{ inv.invoiceNumber }}</td>
                    <td class="text-xs">{{ common.formatDate(inv.invoiceDate) }}</td>
                    <td><p-tag [value]="inv.paymentStatus" [severity]="common.mapStatusToSeverity(inv.paymentStatus)"></p-tag></td>
                    <td class="text-right">{{ common.formatCurrency(inv.grandTotal) }}</td>
                    <td class="text-right font-bold">{{ common.formatCurrency(inv.balanceAmount) }}</td>
                    <td class="text-center">
                      <div class="flex gap-2 justify-center">
                        <p-button icon="pi pi-download" styleClass="p-button-text p-button-rounded p-button-sm text-secondary" (click)="downloadInvoice(inv)"></p-button>
                        <p-button icon="pi pi-arrow-right" styleClass="p-button-text p-button-rounded p-button-sm text-primary" [routerLink]="['/invoices', inv._id]"></p-button>
                      </div>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage"><tr><td colspan="6">No invoices found.</td></tr></ng-template>
              </p-table>
            </p-tabpanel>
            
            <p-tabpanel value="2">
              <p-table [value]="payments()" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Date</th>
                    <th>Mode</th>
                    <th>Transaction ID</th>
                    <th class="text-right">Amount</th>
                    <th class="text-center">Action</th> 
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-pay>
                  <tr>
                    <td class="text-xs">{{ common.formatDate(pay.paymentDate) }}</td>
                    <td>{{ pay.paymentMethod | titlecase }}</td>
                    <td class="font-mono text-xs" style="color: var(--text-tertiary)">{{ pay.transactionId || '-' }}</td>
                    <td class="text-right font-bold" style="color: var(--color-success)">+ {{ common.formatCurrency(pay.amount) }}</td>
                    <td class="text-center">
                       <p-button icon="pi pi-download" styleClass="p-button-text p-button-rounded p-button-sm text-secondary" (click)="downloadReceipt(pay)"></p-button>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage"><tr><td colspan="5">No payments found.</td></tr></ng-template>
              </p-table>
            </p-tabpanel>
          </p-tabpanels>
        </p-tabs>
      </div>
    </main>

  </div>
  }
</div>

<!-- <div class="dashboard-container animate-fadeInDown">

  @if (customer(); as c) {

  <header class="dashboard-header">
    <div class="header-left">
      <p-button icon="pi pi-arrow-left" styleClass="p-button-text p-button-rounded back-btn"
        routerLink="/customer"></p-button>

      <div class="customer-identity">
        <div class="name-row">
          <h1>{{ c.name }}</h1>
          <p-tag [value]="c.isActive ? 'Active' : 'Inactive'" [severity]="c.isActive ? 'success' : 'danger'"
            styleClass="text-xs font-bold"></p-tag>
        </div>

        <div class="badges">
          <span class="id-pill">
            <i class="pi pi-hashtag text-xs mr-1"></i>
            {{ c.code || c._id.substring(c._id.length - 6).toUpperCase() }}
          </span>
          <span class="type-label">{{ c.type }} CUSTOMER</span>
        </div>
      </div>
    </div>

    <div class="header-actions">
      <p-button label="Edit Profile" icon="pi pi-user-edit"
        styleClass="p-button-outlined p-button-secondary p-button-sm" [routerLink]="['../../customer/create']"
        [queryParams]="{id: c._id}"></p-button>
      <p-button label="New Invoice" icon="pi pi-plus" styleClass="p-button-primary p-button-sm"
        routerLink="/invoices/create" [queryParams]="{customerId: c._id}"></p-button>
    </div>
  </header>

  <section class="metrics-grid animate-fadeInUp">
    <div class="metric-card outstanding">
      <div class="icon-box"><i class="pi pi-wallet"></i></div>
      <div class="data-box">
        <label>Outstanding</label>
        <span class="value">{{ common.formatCurrency(closingBalance()) }}</span>
      </div>
    </div>
    <div class="metric-card invoiced">
      <div class="icon-box"><i class="pi pi-receipt"></i></div>
      <div class="data-box">
        <label>Total Invoiced</label>
        <span class="value">{{ common.formatCurrency(totalInvoiced()) }}</span>
      </div>
    </div>
    <div class="metric-card received">
      <div class="icon-box"><i class="pi pi-check-circle"></i></div>
      <div class="data-box">
        <label>Total Received</label>
        <span class="value">{{ common.formatCurrency(totalPaid()) }}</span>
      </div>
    </div>
    <div class="metric-card">
      <div class="icon-box"><i class="pi pi-shield"></i></div>
      <div class="data-box">
        <label>Credit Limit</label>
        <span class="value">{{ common.formatCurrency(c.creditLimit) }}</span>
      </div>
    </div>
  </section>
  <div class="content-split animate-fadeInUp" style="animation-delay: 0.1s;">

    <aside class="profile-card">

      <div class="card-banner"></div>

      <div class="identity-section">
        <div class="avatar-wrapper">
          <p-avatar [image]="c.avatar" [label]="common.getInitials(c.name)" size="xlarge" shape="circle"
            styleClass="user-avatar"></p-avatar>
          <div class="status-indicator" [class.active]="c.isActive"></div>
        </div>

        <h3>{{ c.contactPerson || c.name }}</h3>
        <span class="email">{{ c.email }}</span>

        <div class="actions mt-3">
          <p-button label="Edit" icon="pi pi-pencil"
            styleClass="p-button-rounded p-button-outlined p-button-sm"></p-button>
        </div>
      </div>

      <p-divider></p-divider>

      <div class="details-list">
        <div class="detail-item">
          <div class="icon-circle"><i class="pi pi-phone"></i></div>
          <div class="meta">
            <label>Mobile</label>
            <span>{{ c.phone }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="icon-circle"><i class="pi pi-id-card"></i></div>
          <div class="meta">
            <label>GSTIN</label>
            <span class="font-mono">{{ c.gstNumber || 'N/A' }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="icon-circle"><i class="pi pi-map-marker"></i></div>
          <div class="meta">
            <label>Billing Address</label>
            <span>{{ c.billingAddress?.city || 'City' }}, {{ c.billingAddress?.state || 'State' }}</span>
            <span class="text-xs text-muted">{{ c.billingAddress?.street }}</span>
          </div>
        </div>
      </div>
    </aside>

    <div class="activity-panel">
      <p-tabs value="0">
        <p-tablist>
          <p-tab value="0"><i class="pi pi-list mr-2"></i> Ledger</p-tab>
          <p-tab value="1"><i class="pi pi-file mr-2"></i> Invoices</p-tab>
          <p-tab value="2"><i class="pi pi-wallet mr-2"></i> Payments</p-tab>
        </p-tablist>

        <p-tabpanels>

          <p-tabpanel value="0">
            <p-table [value]="ledgerHistory()" [paginator]="true" [rows]="5">
              <ng-template pTemplate="header">
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Type</th>
                  <th class="text-right">Amount</th>
                  <th class="text-right">Balance</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-row>
                <tr>
                  <td class="font-mono text-xs">{{ common.formatDate(row.date) }}</td>
                  <td class="font-medium">{{ row.description }}</td>
                  <td>
                    <span class="status-badge" [class.success]="row.type === 'credit'"
                      [class.danger]="row.type === 'debit'">
                      {{ row.type }}
                    </span>
                  </td>
                  <td class="text-right font-bold"
                    [style.color]="row.type === 'credit' ? 'var(--color-success)' : 'var(--color-error)'">
                    {{ common.formatCurrency(row.amount) }}
                  </td>
                  <td class="text-right font-bold text-secondary">{{ common.formatCurrency(row.balance) }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="5">No transactions found.</td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

          <p-tabpanel value="1">
            <p-table [value]="invoices()" [paginator]="true" [rows]="5">
              <ng-template pTemplate="header">
                <tr>
                  <th>Invoice #</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th class="text-right">Total</th>
                  <th class="text-right">Due</th>
                  <th class="text-center">Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-inv>
                <tr>
                  <td class="font-bold cursor-pointer" style="color: var(--accent-primary)"
                    [routerLink]="['/invoices', inv._id]">
                    {{ inv.invoiceNumber }}
                  </td>
                  <td class="text-xs">{{ common.formatDate(inv.invoiceDate) }}</td>
                  <td><p-tag [value]="inv.paymentStatus"
                      [severity]="common.mapStatusToSeverity(inv.paymentStatus)"></p-tag></td>
                  <td class="text-right">{{ common.formatCurrency(inv.grandTotal) }}</td>
                  <td class="text-right font-bold">{{ common.formatCurrency(inv.balanceAmount) }}</td>
                  <td class="text-center">
                    <div class="flex gap-2 justify-center">
                      <p-button icon="pi pi-download"
                        styleClass="p-button-text p-button-rounded p-button-sm text-secondary" pTooltip="Download PDF"
                        tooltipPosition="top" (click)="downloadInvoice(inv)"></p-button>
                      <p-button icon="pi pi-arrow-right"
                        styleClass="p-button-text p-button-rounded p-button-sm text-primary"
                        [routerLink]="['/invoices', inv._id]"></p-button>
                    </div>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="6">No invoices found.</td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

          <p-tabpanel value="2">
            <p-table [value]="payments()" [paginator]="true" [rows]="5">
              <ng-template pTemplate="header">
                <tr>
                  <th>Date</th>
                  <th>Mode</th>
                  <th>Transaction ID</th>
                  <th class="text-right">Amount</th>
                  <th class="text-center">Action</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-pay>
                <tr>
                  <td class="text-xs">{{ common.formatDate(pay.paymentDate) }}</td>
                  <td>{{ pay.paymentMethod | titlecase }}</td>
                  <td class="font-mono text-xs" style="color: var(--text-tertiary)">{{ pay.transactionId || '-' }}</td>
                  <td class="text-right font-bold" style="color: var(--color-success)">
                    + {{ common.formatCurrency(pay.amount) }}
                  </td>
                  <td class="text-center">
                    <p-button icon="pi pi-download"
                      styleClass="p-button-text p-button-rounded p-button-sm text-secondary" pTooltip="Download Receipt"
                      tooltipPosition="left" (click)="downloadReceipt(pay)"></p-button>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="5">No payments found.</td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

        </p-tabpanels>
      </p-tabs>
    </div>
  </div>
  }
</div> -->

<!-- <div class="dashboard-container animate-fadeInDown">

  @if (!loading() && customer(); as c) {

  <header class="dashboard-header">
    <div class="header-left">
      <p-button icon="pi pi-arrow-left" styleClass="p-button-text p-button-rounded back-btn" routerLink="/customer"></p-button>
      
      <div class="customer-identity">
        <div class="name-row">
          <h1>{{ c.name }}</h1>
          <p-tag [value]="c.isActive ? 'Active' : 'Inactive'" [severity]="c.isActive ? 'success' : 'danger'" styleClass="text-xs"></p-tag>
        </div>
        
        <div class="badges">
          <span class="id-pill">
            <i class="pi pi-hashtag text-xs mr-1"></i>
            {{ c.code || c._id.substring(c._id.length - 6).toUpperCase() }}
          </span>
          <span class="type-label">{{ c.type }} CUSTOMER</span>
        </div>
      </div>
    </div>

    <div class="header-actions">
      <p-button label="Edit Profile" icon="pi pi-user-edit" styleClass="p-button-outlined p-button-secondary"
        [routerLink]="['../../customer/create']" [queryParams]="{id: c._id}"></p-button>
      <p-button label="New Invoice" icon="pi pi-plus" styleClass="p-button-primary" routerLink="/invoices/create"
        [queryParams]="{customerId: c._id}"></p-button>
    </div>
  </header>

  <section class="metrics-grid animate-fadeInUp">
    <div class="metric-card outstanding">
      <div class="icon-box"><i class="pi pi-wallet"></i></div>
      <div class="data-box">
        <label>Outstanding</label>
        <span class="value">{{ common.formatCurrency(closingBalance()) }}</span>
      </div>
    </div>
    <div class="metric-card invoiced">
      <div class="icon-box"><i class="pi pi-receipt"></i></div>
      <div class="data-box">
        <label>Total Invoiced</label>
        <span class="value">{{ common.formatCurrency(totalInvoiced()) }}</span>
      </div>
    </div>
    <div class="metric-card received">
      <div class="icon-box"><i class="pi pi-check-circle"></i></div>
      <div class="data-box">
        <label>Total Received</label>
        <span class="value">{{ common.formatCurrency(totalPaid()) }}</span>
      </div>
    </div>
    <div class="metric-card">
      <div class="icon-box"><i class="pi pi-shield"></i></div>
      <div class="data-box">
        <label>Credit Limit</label>
        <span class="value">{{ common.formatCurrency(c.creditLimit) }}</span>
      </div>
    </div>
  </section>

  <div class="content-split animate-fadeInUp" style="animation-delay: 0.1s;">

    <aside class="profile-card">
      <div class="avatar-area">
        <p-avatar [image]="c.avatar" [label]="common.getInitials(c.name)" size="xlarge" shape="circle"
          styleClass="user-avatar"></p-avatar>
        <h3>{{ c.contactPerson || c.name }}</h3>
        <span class="email">{{ c.email }}</span>
      </div>

      <div class="details-list">
        <div class="detail-item">
          <i class="pi pi-phone"></i>
          <div>
            <label>Phone</label>
            <span>{{ c.phone }}</span>
          </div>
        </div>
        <div class="detail-item">
          <i class="pi pi-id-card"></i>
          <div>
            <label>GST Number</label>
            <span class="font-mono">{{ c.gstNumber || 'N/A' }}</span>
          </div>
        </div>
        <div class="detail-item">
          <i class="pi pi-map-marker"></i>
          <div>
            <label>Billing Address</label>
            <span>
              {{ c.billingAddress?.city || 'City' }}, {{ c.billingAddress?.state || 'State' }}
            </span>
          </div>
        </div>
      </div>
    </aside>

    <div class="activity-panel">
      <p-tabs value="0">
        <p-tablist>
          <p-tab value="0"><i class="pi pi-list mr-2"></i> Ledger</p-tab>
          <p-tab value="1"><i class="pi pi-file mr-2"></i> Invoices</p-tab>
          <p-tab value="2"><i class="pi pi-wallet mr-2"></i> Payments</p-tab>
        </p-tablist>

        <p-tabpanels>
          
          <p-tabpanel value="0">
            <p-table [value]="ledgerHistory()" [paginator]="true" [rows]="5">
              <ng-template pTemplate="header">
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Type</th>
                  <th class="text-right">Amount</th>
                  <th class="text-right">Balance</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-row>
                <tr>
                  <td class="font-mono">{{ common.formatDate(row.date) }}</td>
                  <td style="font-weight: 500">{{ row.description }}</td>
                  <td>
                    <span class="status-badge" [class.success]="row.type === 'credit'" [class.danger]="row.type === 'debit'">
                      {{ row.type }}
                    </span>
                  </td>
                  <td class="text-right" [style.color]="row.type === 'credit' ? 'var(--color-success)' : 'var(--color-error)'">
                    {{ common.formatCurrency(row.amount) }}
                  </td>
                  <td class="text-right font-bold">{{ common.formatCurrency(row.balance) }}</td>
                </tr>
              </ng-template>
               <ng-template pTemplate="emptymessage">
                <tr><td colspan="5">No transactions found.</td></tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

          <p-tabpanel value="1">
            <p-table [value]="invoices()" [paginator]="true" [rows]="5">
              <ng-template pTemplate="header">
                <tr>
                  <th>Invoice #</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th class="text-right">Total</th>
                  <th class="text-right">Due</th>
                  <th></th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-inv>
                <tr>
                  <td class="font-bold cursor-pointer" style="color: var(--accent-primary)" [routerLink]="['/invoices', inv._id]">
                    {{ inv.invoiceNumber }}
                  </td>
                  <td>{{ common.formatDate(inv.invoiceDate) }}</td>
                  <td><p-tag [value]="inv.paymentStatus" [severity]="common.mapStatusToSeverity(inv.paymentStatus)"></p-tag></td>
                  <td class="text-right">{{ common.formatCurrency(inv.grandTotal) }}</td>
                  <td class="text-right font-bold">{{ common.formatCurrency(inv.balanceAmount) }}</td>
                  <td class="text-center">
                    <p-button icon="pi pi-arrow-right" styleClass="p-button-text p-button-rounded p-button-sm" 
                      [routerLink]="['/invoices', inv._id]"></p-button>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr><td colspan="6">No invoices found.</td></tr>
              </ng-template>
            </p-table>
          </p-tabpanel>
          
          <p-tabpanel value="2">
            <p-table [value]="payments()" [paginator]="true" [rows]="5">
               <ng-template pTemplate="header">
                <tr>
                  <th>Date</th>
                  <th>Mode</th>
                  <th>Transaction ID</th>
                  <th class="text-right">Amount</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-pay>
                <tr>
                  <td>{{ common.formatDate(pay.paymentDate) }}</td>
                  <td>{{ pay.paymentMethod | titlecase }}</td>
                  <td class="font-mono text-xs" style="color: var(--text-tertiary)">{{ pay.transactionId || '-' }}</td>
                  <td class="text-right font-bold" style="color: var(--color-success)">
                    + {{ common.formatCurrency(pay.amount) }}
                  </td>
                </tr>
              </ng-template>
               <ng-template pTemplate="emptymessage">
                <tr><td colspan="4">No payments found.</td></tr>
              </ng-template>
            </p-table>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>

  </div>
  }
</div> -->

<!-- <div class="dashboard-container">

  @if (!loading() && customer(); as c) {

  <header class="dashboard-header animate-fadeInDown">
    <div class="header-left">
      <p-button icon="pi pi-arrow-left" styleClass="p-button-text p-button-rounded text-slate-500" routerLink="/customer"></p-button>
      <div class="customer-identity">
        <div class="name-row">
          <h1 class="customer-name">{{ c.name }}</h1>
          <p-tag [value]="c.isActive ? 'Active' : 'Inactive'" [severity]="c.isActive ? 'success' : 'danger'" styleClass="status-tag"></p-tag>
        </div>
        <div class="badges">
          <span class="id-badge">
            {{ c.code || ('ID: ' + c._id.substring(c._id.length - 6).toUpperCase()) }}
          </span>
          <span class="type-text">{{ c.type | uppercase }} CUSTOMER</span>
        </div>
      </div>
    </div>
    <div class="header-actions">
      <p-button label="Edit Profile" icon="pi pi-user-edit" styleClass="p-button-outlined p-button-secondary"
        [routerLink]="['../../customer/create']" [queryParams]="{id: c._id}"></p-button>
      <p-button label="New Invoice" icon="pi pi-plus" styleClass="p-button-primary" routerLink="/invoices/create"
        [queryParams]="{customerId: c._id}"></p-button>
    </div>
  </header>

  <section class="metrics-grid animate-fadeInUp">
    <div class="metric-card outstanding">
      <div class="metric-icon"><i class="pi pi-wallet"></i></div>
      <div class="metric-content">
        <label>Outstanding</label>
        <span class="value">{{ common.formatCurrency(closingBalance()) }}</span>
      </div>
    </div>
    <div class="metric-card invoiced">
      <div class="metric-icon"><i class="pi pi-receipt"></i></div>
      <div class="metric-content">
        <label>Total Invoiced</label>
        <span class="value">{{ common.formatCurrency(totalInvoiced()) }}</span>
      </div>
    </div>
    <div class="metric-card paid">
      <div class="metric-icon"><i class="pi pi-check-circle"></i></div>
      <div class="metric-content">
        <label>Total Received</label>
        <span class="value">{{ common.formatCurrency(totalPaid()) }}</span>
      </div>
    </div>
    <div class="metric-card limit">
      <div class="metric-icon"><i class="pi pi-shield"></i></div>
      <div class="metric-content">
        <label>Credit Limit</label>
        <span class="value">{{ common.formatCurrency(c.creditLimit) }}</span>
      </div>
    </div>
  </section>

  <div class="content-split animate-fadeInUp" style="animation-delay: 0.1s;">

    <aside class="profile-card">
      <div class="avatar-section">
        <p-avatar [image]="c.avatar" [label]="common.getInitials(c.name)" size="xlarge" shape="circle"
          styleClass="profile-avatar"></p-avatar>
        <h3>{{ c.contactPerson || c.name }}</h3>
        <span class="sub-text">{{ c.email }}</span>
      </div>
      <div class="info-list">
        <div class="info-item">
          <i class="pi pi-phone"></i>
          <div>
            <label>Phone</label>
            <span>{{ c.phone }}</span>
          </div>
        </div>
        <div class="info-item">
          <i class="pi pi-id-card"></i>
          <div>
            <label>GST Number</label>
            <span class="font-mono">{{ c.gstNumber || 'N/A' }}</span>
          </div>
        </div>
        <div class="info-item">
          <i class="pi pi-map-marker"></i>
          <div>
            <label>Billing Address</label>
            <span>{{ c.billingAddress?.city || 'City' }}, {{ c.billingAddress?.state || 'State' }}</span>
          </div>
        </div>
      </div>
    </aside>

    <div class="activity-panel">
      <p-tabs value="0" styleClass="smooth-tabs">
        
        <p-tablist>
          <p-tab value="0">
            <i class="pi pi-list mr-2"></i> Ledger
          </p-tab>
          <p-tab value="1">
            <i class="pi pi-file mr-2"></i> Invoices
          </p-tab>
          <p-tab value="2">
            <i class="pi pi-wallet mr-2"></i> Payments
          </p-tab>
        </p-tablist>

        <p-tabpanels>
          
          <p-tabpanel value="0">
            <p-table [value]="ledgerHistory()" [paginator]="true" [rows]="5" styleClass="smooth-table">
              <ng-template pTemplate="header">
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Type</th>
                  <th class="text-right">Amount</th>
                  <th class="text-right">Balance</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-row>
                <tr>
                  <td>{{ common.formatDate(row.date) }}</td>
                  <td class="font-medium">{{ row.description }}</td>
                  <td>
                    <span class="status-badge" [class.positive]="row.type === 'credit'" [class.negative]="row.type === 'debit'">
                      {{ row.type }}
                    </span>
                  </td>
                  <td class="text-right font-medium" [class.text-success]="row.type === 'credit'" [class.text-error]="row.type === 'debit'">
                    {{ common.formatCurrency(row.amount) }}
                  </td>
                  <td class="text-right font-bold">
                    {{ common.formatCurrency(row.balance) }}
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr><td colspan="5" class="empty-msg">No transaction history found.</td></tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

          <p-tabpanel value="1">
            <p-table [value]="invoices()" [paginator]="true" [rows]="5" styleClass="smooth-table">
              <ng-template pTemplate="header">
                <tr>
                  <th>Invoice #</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th class="text-right">Amount</th>
                  <th class="text-right">Due</th>
                  <th></th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-inv>
                <tr>
                  <td class="font-bold cursor-pointer text-primary" [routerLink]="['/invoices', inv._id]">
                    {{ inv.invoiceNumber }}
                  </td>
                  <td>{{ common.formatDate(inv.invoiceDate) }}</td>
                  <td><p-tag [value]="inv.paymentStatus" [severity]="common.mapStatusToSeverity(inv.paymentStatus)"></p-tag></td>
                  <td class="text-right">{{ common.formatCurrency(inv.grandTotal) }}</td>
                  <td class="text-right font-bold">{{ common.formatCurrency(inv.balanceAmount) }}</td>
                  <td class="text-center">
                     <p-button icon="pi pi-chevron-right" styleClass="p-button-text p-button-rounded p-button-sm text-secondary" [routerLink]="['/invoices', inv._id]"></p-button>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr><td colspan="6" class="empty-msg">No invoices found.</td></tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

          <p-tabpanel value="2">
            <p-table [value]="payments()" [paginator]="true" [rows]="5" styleClass="smooth-table">
              <ng-template pTemplate="header">
                <tr>
                  <th>Date</th>
                  <th>Mode</th>
                  <th>Transaction ID</th>
                  <th class="text-right">Amount</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-pay>
                <tr>
                  <td>{{ common.formatDate(pay.paymentDate) }}</td>
                  <td>{{ pay.paymentMethod | titlecase }}</td>
                  <td class="font-mono text-xs text-secondary">{{ pay.transactionId || '-' }}</td>
                  <td class="text-right text-success font-bold">+ {{ common.formatCurrency(pay.amount) }}</td>
                </tr>
              </ng-template>
               <ng-template pTemplate="emptymessage">
                <tr><td colspan="4" class="empty-msg">No payments found.</td></tr>
              </ng-template>
            </p-table>
          </p-tabpanel>

        </p-tabpanels>
      </p-tabs>
    </div>
  </div>
  }
</div> -->
<!-- <div class="form-page-container">
  @if (customer(); as c) {
    <div class="form-card animate-fadeIn">
      
      <header class="form-header">
        <div class="header-content">
          <h2 class="form-title">{{ c.name }}</h2>
          <div class="header-badges">
            <span class="id-badge">ID: {{ c.code || 'GEN-' + (c._id | slice:-4) }}</span>
            <p-tag 
              [value]="c.isActive ? 'Active' : 'Inactive'" 
              [severity]="c.isActive ? 'success' : 'danger'">
            </p-tag>
          </div>
        </div>

        <div class="header-actions">
          <p-button icon="pi pi-arrow-left" label="Back" styleClass="p-button-text" routerLink="/customer"></p-button>
          <p-button icon="pi pi-pencil" label="Edit" styleClass="p-button-outlined" [routerLink]="['../edit', c._id]"></p-button>
        </div>
      </header>

      <p-divider styleClass="m-0"></p-divider>

      <div class="form-body">

        <section class="form-section summary-section">
           <div class="summary-grid">
              <div class="identity-box">
                 <p-avatar 
                    [image]="c.avatar" 
                    [label]="getInitials(c.name)" 
                    size="xlarge" 
                    shape="circle" 
                    styleClass="shadow-1">
                 </p-avatar>
                 <div class="identity-text">
                    <h3>{{ c.contactPerson }}</h3>
                    <span>{{ c.type | titlecase }} Customer</span>
                 </div>
              </div>

              <div class="financial-snapshot">
                  <div class="snapshot-item">
                      <label>Outstanding</label>
                      <span class="value" [class.text-red-500]="c.outstandingBalance > 0">
                          {{ formatCurrency(c.outstandingBalance) }}
                      </span>
                  </div>
                  <div class="snapshot-divider"></div>
                  <div class="snapshot-item">
                      <label>Credit Limit</label>
                      <span class="value">{{ formatCurrency(c.creditLimit) }}</span>
                  </div>
              </div>
           </div>
        </section>

        <section class="form-section">
          <h4 class="section-title">Basic Information</h4>
          <div class="form-grid">
            
            <div class="read-only-field">
              <label>Email Address</label>
              <div class="field-value">
                  <i class="pi pi-envelope text-xs mr-2 text-gray-400"></i>
                  {{ c.email || '-' }}
              </div>
            </div>

            <div class="read-only-field">
              <label>Primary Phone</label>
              <div class="field-value">
                  <i class="pi pi-phone text-xs mr-2 text-gray-400"></i>
                  {{ c.phone || '-' }}
              </div>
            </div>

            <div class="read-only-field">
              <label>Alternate Phone</label>
              <div class="field-value">{{ c.altPhone || '-' }}</div>
            </div>

            <div class="read-only-field">
              <label>GST Number</label>
              <div class="field-value font-mono">{{ c.gstNumber || '-' }}</div>
            </div>

            <div class="read-only-field">
              <label>PAN Number</label>
              <div class="field-value font-mono">{{ c.panNumber || '-' }}</div>
            </div>

            <div class="read-only-field">
              <label>Payment Terms</label>
              <div class="field-value">{{ c.paymentTerms || 'Standard' }}</div>
            </div>

          </div>
        </section>

        <section class="form-section">
          <h4 class="section-title">Addresses</h4>
          <div class="address-grid">
              
              <div class="address-card read-only">
                  <h5>Billing Address</h5>
                  <div class="addr-content">
                      <p>{{ c.billingAddress?.street || 'No Street' }}</p>
                      <p>{{ c.billingAddress?.city || 'No City' }}, {{ c.billingAddress?.state }}</p>
                      <p>{{ c.billingAddress?.zipCode }}</p>
                  </div>
              </div>

              <div class="address-card read-only">
                  <div class="address-header">
                      <h5>Shipping Address</h5>
                      @if (isSameAddress()) {
                        <span class="pill text-xs">Same as Billing</span>
                      }
                  </div>
                  <div class="addr-content">
                      <p>{{ c.shippingAddress?.street || 'No Street' }}</p>
                      <p>{{ c.shippingAddress?.city || 'No City' }}, {{ c.shippingAddress?.state }}</p>
                      <p>{{ c.shippingAddress?.zipCode }}</p>
                  </div>
              </div>

          </div>
        </section>

        <section class="form-section">
           <h4 class="section-title">Notes & Tags</h4>
           <div class="form-grid">
               <div class="read-only-field span-2">
                   <label>Internal Notes</label>
                   <div class="field-value description-box">
                       {{ c.notes || 'No notes available.' }}
                   </div>
               </div>
               <div class="read-only-field span-2">
                   <label>Tags</label>
                   <div class="tags-container">
                      @for (tag of getFilteredTags(); track $index) {
                        <p-tag [value]="tag" styleClass="mr-2"></p-tag>
                      } @empty {
                        <span class="text-sm text-gray-400">No tags</span>
                      }
                   </div>
               </div>
           </div>
        </section>

      </div>
    </div>
  } @else {
    <div class="form-page-container flex-center">
        <i class="pi pi-spin pi-spinner text-4xl text-[var(--text-secondary)]"></i>
    </div>
  }
</div> -->