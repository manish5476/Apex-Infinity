<div class="page-container animate-fadeIn">
  @if (!isLoading() && organization()) {
  <div class="org-layout">

    <!-- ========================================
         HEADER - Premium Gradient Banner
         ======================================== -->
    <header class="org-header">
      <div class="header-content">

        <div class="header-left">
          <button class="back-button" routerLink="/admin/dashboard" pTooltip="Back to Dashboard"
            tooltipPosition="bottom">
            <i class="pi pi-arrow-left"></i>
          </button>

          <div class="org-identity">
            <h1>{{ organization().name }}</h1>

            <div class="org-meta">
              <div class="meta-item">
                <p-tag [value]="organization().isActive ? 'Active' : 'Inactive'"
                  [severity]="organization().isActive ? 'success' : 'danger'" [rounded]="true"></p-tag>
              </div>

              <span class="meta-separator">•</span>

              <div class="meta-item">
                <i class="pi pi-hashtag"></i>
                <span>{{ organization().uniqueShopId }}</span>
              </div>

              <span class="meta-separator hide-mobile">•</span>

              <div class="meta-item hide-mobile">
                <i class="pi pi-user"></i>
                <span>{{ organization().owner?.name }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="header-right">
          <button pButton icon="pi pi-download" label="Export" class="p-button-sm hide-mobile"
            pTooltip="Export organization data"></button>

          <button pButton icon="pi pi-share-alt" label="Share" class="p-button-sm"></button>
        </div>

      </div>
    </header>

    <!-- ========================================
         MAIN BODY - Two Column Layout
         ======================================== -->
    <main class="org-body">

      <!-- SIDEBAR: Organization Info Card -->
      <aside class="org-sidebar glass-surface">

        <!-- Logo & Status -->
        <div class="logo-section">
          <div class="logo-wrapper">
            <div class="logo-placeholder">
              <span>{{ getInitials(organization().name) }}</span>
            </div>
            @if (organization().isActive) {
            <div class="status-indicator" pTooltip="Organization Active"></div>
            }
          </div>

          <h4 class="org-name-display">{{ organization().name }}</h4>
          <p class="org-id-display">#{{ organization().uniqueShopId }}</p>
        </div>

        <!-- Contact Details -->
        <div class="sidebar-details">

          <div class="detail-item">
            <label>
              <i class="pi pi-envelope"></i>
              Primary Email
            </label>
            <span class="value">{{ organization().primaryEmail }}</span>
          </div>

          <div class="detail-item">
            <label>
              <i class="pi pi-phone"></i>
              Phone Number
            </label>
            <span [class]="organization().primaryPhone ? 'value' : 'value value-empty'">
              {{ organization().primaryPhone || 'Not provided' }}
            </span>
          </div>

          <div class="detail-item">
            <label>
              <i class="pi pi-file"></i>
              GST Number
            </label>
            <span [class]="organization().gstNumber ? 'value' : 'value value-empty'">
              {{ organization().gstNumber || 'Not registered' }}
            </span>
          </div>

          <div class="detail-item">
            <label>
              <i class="pi pi-map-marker"></i>
              Main Branch
            </label>
            <span class="value">{{ organization().branches?.[0]?.name || 'Head Office' }}</span>
          </div>

        </div>

        <!-- Quick Stats -->
        <div class="sidebar-stats">
          <div class="stat-card">
            <div class="stat-value">{{ activeMembers().length }}</div>
            <div class="stat-label">Members</div>
          </div>

          <div class="stat-card">
            <div class="stat-value">{{ organization().branches?.length || 1 }}</div>
            <div class="stat-label">Branches</div>
          </div>
        </div>

      </aside>

      <!-- CONTENT: Tabbed Sections -->
      <section class="org-content">

        <p-tabs [value]="activeTabValue()">

          <!-- Tab Navigation -->
          <p-tablist>
            <p-tab value="0">
              <i class="pi pi-cog"></i>
              <span>General</span>
            </p-tab>

            <p-tab value="1">
              <i class="pi pi-users"></i>
              <span>Team</span>
              @if (pendingMembers().length) {
              <p-badge [value]="pendingMembers().length.toString()" severity="warn"
                [style]="{'margin-left': '0.5rem'}"></p-badge>
              }
            </p-tab>

            <p-tab value="2">
              <i class="pi pi-history"></i>
              <span>Activity</span>
            </p-tab>

            @if (isOwner()) {
            <p-tab value="3">
              <i class="pi pi-shield"></i>
              <span>Security</span>
            </p-tab>
            }
          </p-tablist>

          <!-- Tab Panels -->
          <p-tabpanels>

            <!-- ==================== TAB 0: GENERAL ==================== -->
            <p-tabpanel value="0">
              <div class="panel-content animate-fadeInUp">

                <div class="panel-header">
                  <h3>Organization Details</h3>
                  <p>Update your company's information, contact details, and tax registration.</p>
                </div>

                <form [formGroup]="orgForm" (ngSubmit)="updateOrgDetails()" class="form-grid">

                  <div class="field">
                    <label>
                      Company Name
                      <span class="required">*</span>
                    </label>
                    <input pInputText formControlName="name" placeholder="Enter company name" />
                    <span class="field-hint">This will be displayed across the platform</span>
                  </div>

                  <div class="field">
                    <label>GST Number</label>
                    <input pInputText formControlName="gstNumber" placeholder="22AAAAA0000A1Z5"
                      style="text-transform: uppercase;" />
                    <span class="field-hint">15-character GSTIN</span>
                  </div>

                  <div class="field">
                    <label>
                      Primary Email
                      <span class="required">*</span>
                    </label>
                    <input pInputText type="email" formControlName="primaryEmail" placeholder="contact@company.com" />
                  </div>

                  <div class="field">
                    <label>Primary Phone</label>
                    <input pInputText type="tel" formControlName="primaryPhone" placeholder="+91 98765 43210" />
                  </div>

                  <div class="field">
                    <label>Website</label>
                    <input pInputText type="url" placeholder="https://company.com" />
                    <span class="field-hint">Optional</span>
                  </div>

                  <div class="field">
                    <label>Industry</label>
                    <select class="p-inputtext">
                      <option value="">Select industry</option>
                      <option value="retail">Retail</option>
                      <option value="manufacturing">Manufacturing</option>
                      <option value="services">Services</option>
                      <option value="technology">Technology</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-actions">
                    <button pButton label="Cancel" type="button" class="p-button-text p-button-secondary"></button>

                    <button pButton label="Save Changes" icon="pi pi-check" type="submit"
                      [loading]="isSaving()"></button>
                  </div>

                </form>

              </div>
            </p-tabpanel>

            <!-- ==================== TAB 1: TEAM ==================== -->
            <p-tabpanel value="1">
              <div class="panel-content animate-fadeInUp">

                <!-- Active Members Section -->
                <div class="flex justify-between items-center mb-6">
                  <div>
                    <h3 class="m-0 text-lg font-semibold">Active Team Members</h3>
                    <p class="text-sm text-[var(--text-secondary)] m-0 mt-1">
                      Manage roles, permissions, and access levels
                    </p>
                  </div>

                  <button pButton label="Invite Member" icon="pi pi-user-plus" (click)="showInviteDialog = true"
                    class="p-button-sm"></button>
                </div>

                <p-table [value]="activeMembers()" [rowHover]="true" styleClass="p-datatable-sm">

                  <ng-template pTemplate="header">
                    <tr>
                      <th style="width: 35%">User</th>
                      <th style="width: 30%">Email</th>
                      <th style="width: 20%">Role</th>
                      <th style="width: 15%; text-align: right;">Actions</th>
                    </tr>
                  </ng-template>

                  <ng-template pTemplate="body" let-member>
                    <tr>
                      <td>
                        <div class="flex items-center gap-3">
                          <p-avatar [label]="getInitials(member.name)" shape="circle" size="normal" [style]="{
                              'background': 'var(--accent-primary)',
                              'color': 'white',
                              'font-weight': '600'
                            }"></p-avatar>

                          <div>
                            <div class="font-semibold text-[var(--text-primary)]">
                              {{ member.name }}
                            </div>
                            @if (member._id === organization().owner._id) {
                            <div class="text-xs text-[var(--accent-primary)] font-semibold mt-1">
                              <i class="pi pi-shield"></i> Owner
                            </div>
                            }
                          </div>
                        </div>
                      </td>

                      <td class="text-[var(--text-secondary)]">
                        {{ member.email }}
                      </td>

                      <td>
                        <p-tag [value]="member.role?.name || 'Member'"
                          [severity]="member.role?.name === 'Admin' ? 'info' : 'secondary'" [rounded]="true"></p-tag>
                      </td>

                      <td style="text-align: right;">
                        @if (member._id !== organization().owner._id) {
                        <button pButton icon="pi pi-ellipsis-v" class="p-button-text p-button-sm"
                          [pTooltip]="'More options'"></button>

                        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm"
                          (click)="removeMember(member._id)" pTooltip="Remove member"></button>
                        }
                      </td>
                    </tr>
                  </ng-template>

                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="4" class="text-center py-8">
                        <div class="empty-state">
                          <i class="pi pi-users"></i>
                          <p>No team members found</p>
                        </div>
                      </td>
                    </tr>
                  </ng-template>

                </p-table>

                <!-- Pending Approvals Section -->
                @if (pendingMembers().length > 0) {
                <div class="mt-8 pt-6" style="border-top: 1px solid var(--border-primary);">

                  <div class="flex items-center gap-2 mb-4">
                    <i class="pi pi-clock text-[var(--color-accent-amber)]"></i>
                    <h3 class="text-[var(--color-accent-amber)] m-0">
                      Pending Approvals
                    </h3>
                    <p-badge [value]="pendingMembers().length.toString()" severity="warn"></p-badge>
                  </div>

                  <p-table [value]="pendingMembers()" styleClass="p-datatable-sm">

                    <ng-template pTemplate="header">
                      <tr>
                        <th style="width: 40%">User</th>
                        <th style="width: 30%">Requested</th>
                        <th style="width: 30%; text-align: right;">Action</th>
                      </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-pending>
                      <tr>
                        <td>
                          <div class="font-semibold">{{ pending.name }}</div>
                          <div class="text-xs text-[var(--text-secondary)] mt-1">
                            {{ pending.email }}
                          </div>
                        </td>

                        <td class="text-sm text-[var(--text-secondary)]">
                          {{ pending.createdAt | date:'MMM d, y' }}
                        </td>

                        <td style="text-align: right;">
                          <button pButton label="Approve" icon="pi pi-check" size="small"
                            class="p-button-success p-button-sm" (click)="approveMember(pending._id)"></button>

                          <button pButton icon="pi pi-times" size="small"
                            class="p-button-text p-button-danger p-button-sm ml-2" pTooltip="Reject"></button>
                        </td>
                      </tr>
                    </ng-template>

                  </p-table>

                </div>
                }

              </div>
            </p-tabpanel>

            <!-- ==================== TAB 2: ACTIVITY ==================== -->
            <p-tabpanel value="2">
              <div class="panel-content animate-fadeInUp">

                <div class="panel-header">
                  <h3>Activity Log</h3>
                  <p>Track all important events and changes in your organization.</p>
                </div>

                @if (activityLogs().length > 0) {
                <p-timeline [value]="activityLogs()" align="left">

                  <ng-template pTemplate="marker" let-log>
                    <div style="background: var(--accent-primary); 
                        width: 1.5rem; 
                        height: 1.5rem; 
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 0.7rem;">
                      <i class="pi pi-circle-fill"></i>
                    </div>
                  </ng-template>

                  <ng-template pTemplate="content" let-log>
                    <div class="log-item">
                      <span class="log-date">
                        <i class="pi pi-calendar mr-1"></i>
                        {{ log.createdAt | date:'MMM d, y - h:mm a' }}
                      </span>
                      <span class="log-desc">{{ log.description }}</span>
                      <span class="log-user">
                        <i class="pi pi-user mr-1"></i>
                        {{ log.userId?.name || 'System' }}
                      </span>
                    </div>
                  </ng-template>

                </p-timeline>
                } @else {
                <div class="empty-state">
                  <i class="pi pi-history"></i>
                  <p>No activity recorded yet</p>
                </div>
                }

              </div>
            </p-tabpanel>

            <!-- ==================== TAB 3: SECURITY (Owner Only) ==================== -->
            @if (isOwner()) {
            <p-tabpanel value="3">
              <div class="panel-content animate-fadeInUp">

                <div class="panel-header">
                  <h3 style="color: var(--color-error);">
                    <i class="pi pi-exclamation-triangle mr-2"></i>
                    Danger Zone
                  </h3>
                  <p>Critical actions that permanently affect your organization.</p>
                </div>

                <!-- Transfer Ownership -->
                <div class="danger-box warning">
                  <div class="box-info">
                    <strong>Transfer Ownership</strong>
                    <p>
                      Hand over complete control to another team member.
                      You will lose all owner privileges immediately.
                    </p>
                  </div>
                  <button pButton label="Transfer" icon="pi pi-arrow-right" class="p-button-warning"
                    (click)="showTransferDialog = true"></button>
                </div>

                <!-- Delete Organization -->
                <div class="danger-box delete">
                  <div class="box-info">
                    <strong>Delete Organization</strong>
                    <p>
                      Permanently remove this organization, all data, members, and branches.
                      <strong>This action cannot be undone.</strong>
                    </p>
                  </div>
                  <button pButton label="Delete Forever" icon="pi pi-trash" class="p-button-danger"
                    (click)="deleteOrganization()"></button>
                </div>

              </div>
            </p-tabpanel>
            }

          </p-tabpanels>

        </p-tabs>

      </section>

    </main>

  </div>

  } @else {

  <!-- Loading State -->
  <div class="loading-state">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: var(--accent-primary)"></i>
    <p>Loading organization details...</p>
  </div>

  }

</div>

<!-- ========================================
     DIALOG: Invite Team Member
     ======================================== -->
<p-dialog header="Invite Team Member" [(visible)]="showInviteDialog" [modal]="true" [dismissableMask]="true"
  [style]="{width: '450px', maxWidth: '95vw'}">

  <form [formGroup]="inviteForm" class="flex flex-col gap-4 mt-3">

    <div class="field">
      <label>Full Name <span class="required">*</span></label>
      <input pInputText formControlName="name" placeholder="John Doe" autofocus />
    </div>

    <div class="field">
      <label>Email Address <span class="required">*</span></label>
      <input pInputText type="email" formControlName="email" placeholder="john@company.com" />
      <span class="field-hint">An invitation will be sent to this email</span>
    </div>

    <div class="field">
      <label>Role</label>
      <select formControlName="role" class="p-inputtext w-full">
        <option [ngValue]="null">Select Role</option>
        @for (r of availableRoles; track r.value) {
        <option [value]="r.value">{{r.label}}</option>
        }
      </select>
    </div>

  </form>

  <ng-template pTemplate="footer">
    <button pButton label="Cancel" (click)="showInviteDialog = false" class="p-button-text p-button-secondary"></button>

    <button pButton label="Send Invite" icon="pi pi-send" (click)="inviteUser()" [disabled]="inviteForm.invalid"
      [loading]="isSaving()"></button>
  </ng-template>

</p-dialog>

<!-- ========================================
     DIALOG: Transfer Ownership
     ======================================== -->
<p-dialog header="Transfer Ownership" [(visible)]="showTransferDialog" [modal]="true" [dismissableMask]="true"
  [style]="{width: '500px', maxWidth: '95vw'}">

  <form [formGroup]="transferForm" class="flex flex-col gap-4 mt-3">

    <!-- Warning Banner -->
    <div style="
      background: color-mix(in srgb, var(--color-accent-amber) 15%, transparent);
      border: 1px solid color-mix(in srgb, var(--color-accent-amber) 40%, transparent);
      padding: 1rem;
      border-radius: var(--ui-border-radius);
      display: flex;
      gap: 0.75rem;">

      <i class="pi pi-exclamation-triangle" style="color: var(--color-accent-amber); font-size: 1.25rem;"></i>

      <div style="font-size: var(--font-size-sm); line-height: 1.5;">
        You are about to transfer full ownership of
        <strong>{{ organization()?.name }}</strong> to another user.
        This action is immediate and cannot be undone.
      </div>
    </div>

    <div class="field">
      <label>Select New Owner <span class="required">*</span></label>
      <select formControlName="newOwnerId" class="p-inputtext w-full">
        <option [ngValue]="null">Choose a team member...</option>
        @for (m of activeMembers(); track m._id) {
        @if (m._id !== organization().owner._id) {
        <option [value]="m._id">{{m.name}} ({{m.email}})</option>
        }
        }
      </select>
    </div>

    <div class="field">
      <label>Type <strong>"CONFIRM"</strong> to proceed</label>
      <input pInputText formControlName="confirmName" placeholder="CONFIRM" style="text-transform: uppercase;" />
    </div>

  </form>

  <ng-template pTemplate="footer">
    <button pButton label="Cancel" (click)="showTransferDialog = false" class="p-button-text"></button>

    <button pButton label="Transfer Ownership" icon="pi pi-arrow-right" class="p-button-danger"
      [disabled]="transferForm.invalid || transferForm.value.confirmName !== 'CONFIRM'"
      (click)="transferOwnership()"></button>
  </ng-template>

</p-dialog>

<!-- Confirmation Dialog Component -->
<p-confirmDialog></p-confirmDialog>

<!-- Toast Notifications -->
<p-toast position="top-right"></p-toast>
<!-- <div class="page-container animate-fadeIn">

  @if (!isLoading() && organization()) {
  <div class="org-layout">

    ============================
    1. HEADER (Gradient Banner)
    ============================
    <header class="org-header">
      <div class="header-content" style="max-width: 100%">
        <div class="header-left">
          <button pButton icon="pi pi-arrow-left" class="p-button-text p-button-rounded text-white"
            routerLink="/admin/dashboard"></button>

          <div class="org-identity">
            <h1>{{ organization().name }}</h1>
            <div class="org-meta">
              <p-tag [value]="organization().isActive ? 'Active' : 'Inactive'"
                [severity]="organization().isActive ? 'success' : 'danger'"></p-tag>
              <span class="meta-separator">•</span>
              <span class="meta-id"><i class="pi pi-hashtag text-xs"></i> {{ organization().uniqueShopId }}</span>
              <span class="meta-separator">•</span>
              <span class="meta-owner">Owner: {{ organization().owner?.name }}</span>
            </div>
          </div>
        </div>

        <div class="header-right">
          Placeholder for top-level actions
          <button pButton icon="pi pi-share-alt" label="Share"
            class="p-button-outlined p-button-sm text-white border-white-alpha-30"></button>
        </div>
      </div>
    </header>


    ============================
    2. MAIN BODY
    ============================
    <main class="org-body" style="max-width: 100%">

      SIDEBAR: Static Info
      <aside class="org-sidebar glass-surface">
        <div class="logo-wrapper">
          <div class="logo-placeholder">
            <span>{{ getInitials(organization().name) }}</span>
          </div>
        </div>

        <div class="sidebar-details">
          <div class="detail-item">
            <label>Primary Email</label>
            <span>{{ organization().primaryEmail }}</span>
          </div>
          <div class="detail-item">
            <label>Phone</label>
            <span>{{ organization().primaryPhone || '--' }}</span>
          </div>
          <div class="detail-item">
            <label>GST Number</label>
            <span>{{ organization().gstNumber || 'Not Filed' }}</span>
          </div>
          <div class="detail-item">
            <label>Main Branch</label>
            <span>{{ organization().branches?.[0]?.name }}</span>
          </div>
        </div>

        <p-divider></p-divider>

        <div class="sidebar-stats">
          <div class="stat">
            <strong>{{ activeMembers().length }}</strong>
            <span>Members</span>
          </div>
          <div class="stat">
            <strong>{{ organization().branches?.length || 1 }}</strong>
            <span>Branches</span>
          </div>
        </div>
      </aside>


      CONTENT: Tabs
      <section class="org-content">
        <p-tabs [value]="activeTabValue()">

          <p-tablist>
            <p-tab value="0"><i class="pi pi-cog mr-2"></i> General</p-tab>
            <p-tab value="1">
              <i class="pi pi-users mr-2"></i> Team
              @if (pendingMembers().length) {
              <p-badge [value]="pendingMembers().length.toString()" severity="warn" styleClass="ml-2"></p-badge>
              }
            </p-tab>
            <p-tab value="2"><i class="pi pi-history mr-2"></i> Activity</p-tab>
            @if (isOwner()) {
            <p-tab value="3"><i class="pi pi-shield mr-2"></i> Danger Zone</p-tab>
            }
          </p-tablist>

          <p-tabpanels>

            TAB 0: GENERAL SETTINGS
            <p-tabpanel value="0">
              <div class="panel-content glass-surface">
                <div class="panel-header">
                  <h3>Organization Details</h3>
                  <p>Manage your company's public profile and contact info.</p>
                </div>

                <form [formGroup]="orgForm" (ngSubmit)="updateOrgDetails()" class="form-grid">
                  <div class="field">
                    <label>Company Name</label>
                    <input pInputText formControlName="name" />
                  </div>
                  <div class="field">
                    <label>GST Number</label>
                    <input pInputText formControlName="gstNumber" />
                  </div>
                  <div class="field">
                    <label>Primary Email</label>
                    <input pInputText formControlName="primaryEmail" />
                  </div>
                  <div class="field">
                    <label>Primary Phone</label>
                    <input pInputText formControlName="primaryPhone" />
                  </div>

                  <div class="form-actions">
                    <button pButton label="Save Changes" icon="pi pi-check" [loading]="isSaving()"></button>
                  </div>
                </form>
              </div>
            </p-tabpanel>


            TAB 1: TEAM MANAGEMENT
            <p-tabpanel value="1">
              <div class="panel-content glass-surface">

                Section: Active Members
                <div class="flex justify-between items-center mb-4">
                  <div>
                    <h3 class="m-0 text-lg">Active Team</h3>
                    <p class="text-sm text-[var(--text-secondary)] m-0">Manage access levels and roles.</p>
                  </div>
                  <button pButton label="Invite Member" icon="pi pi-plus" (click)="showInviteDialog = true"
                    class="p-button-outlined"></button>
                </div>

                <p-table [value]="activeMembers()" styleClass="p-datatable-sm" [rowHover]="true">
                  <ng-template pTemplate="header">
                    <tr>
                      <th>User</th>
                      <th>Email</th>
                      <th>Role</th>
                      <th class="text-right">Actions</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-member>
                    <tr>
                      <td>
                        <div class="flex items-center gap-2">
                          <p-avatar [label]="getInitials(member.name)" shape="circle"
                            [style]="{'background-color': 'var(--bg-ternary)', 'color': 'var(--text-secondary)'}"></p-avatar>
                          <span class="font-medium">{{ member.name }}</span>
                        </div>
                      </td>
                      <td class="text-[var(--text-secondary)]">{{ member.email }}</td>
                      <td><p-tag [value]="member.role?.name || 'Member'" severity="info"></p-tag></td>
                      <td class="text-right">
                        @if (member._id !== organization().owner._id) {
                        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm"
                          (click)="removeMember(member._id)"></button>
                        } @else {
                        <span class="text-xs font-bold text-[var(--accent-primary)]">OWNER</span>
                        }
                      </td>
                    </tr>
                  </ng-template>
                </p-table>

                Section: Pending Requests
                @if (pendingMembers().length > 0) {
                <div class="mt-8 pt-6 border-t border-[var(--border-primary)]">
                  <h3 class="text-[var(--color-warning)] mb-3 flex items-center gap-2">
                    <i class="pi pi-clock"></i> Pending Approvals
                  </h3>
                  <p-table [value]="pendingMembers()" styleClass="p-datatable-sm">
                    <ng-template pTemplate="header">
                      <tr>
                        <th>User</th>
                        <th>Requested</th>
                        <th class="text-right">Action</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-pending>
                      <tr>
                        <td>
                          <div class="font-medium">{{ pending.name }}</div>
                          <div class="text-xs text-[var(--text-secondary)]">{{ pending.email }}</div>
                        </td>
                        <td class="text-sm">{{ pending.createdAt | date }}</td>
                        <td class="text-right">
                          <button pButton label="Approve" icon="pi pi-check" size="small" class="p-button-success mr-2"
                            (click)="approveMember(pending._id)"></button>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
                }
              </div>
            </p-tabpanel>


            TAB 2: ACTIVITY
            <p-tabpanel value="2">
              <div class="panel-content glass-surface">
                <h3 class="mb-4">Audit Log</h3>
                <p-timeline [value]="activityLogs()">
                  <ng-template pTemplate="content" let-log>
                    <div class="log-item">
                      <span class="log-date">{{ log.createdAt | date:'medium' }}</span>
                      <span class="log-desc">{{ log.description }}</span>
                      <span class="log-user">by {{ log.userId?.name || 'System' }}</span>
                    </div>
                  </ng-template>
                </p-timeline>
              </div>
            </p-tabpanel>


            TAB 3: DANGER ZONE
            @if (isOwner()) {
            <p-tabpanel value="3">
              <div class="panel-content glass-surface">
                <h3 class="text-red-500 mb-1">Danger Zone</h3>
                <p class="mb-4 text-sm">Destructive actions regarding your organization.</p>

                <div class="danger-box">
                  <div class="box-info">
                    <strong>Transfer Ownership</strong>
                    <p>Transfer this organization to another member. You will lose owner privileges.</p>
                  </div>
                  <button pButton label="Transfer" class="p-button-warning p-button-outlined"
                    (click)="showTransferDialog = true"></button>
                </div>

                <div class="danger-box delete">
                  <div class="box-info">
                    <strong>Delete Organization</strong>
                    <p>Permanently remove this organization and all its data. This cannot be undone.</p>
                  </div>
                  <button pButton label="Delete Organization" class="p-button-danger"
                    (click)="deleteOrganization()"></button>
                </div>
              </div>
            </p-tabpanel>
            }

          </p-tabpanels>
        </p-tabs>
      </section>

    </main>
  </div>
  } @else {
  <div class="loading-state">
    <i class="pi pi-spin pi-spinner" style="font-size: 2rem; color: var(--accent-primary)"></i>
  </div>
  }
</div>

DIALOG: Invite User
<p-dialog header="Invite Team Member" [(visible)]="showInviteDialog" [modal]="true" [style]="{width: '400px'}">
  <form [formGroup]="inviteForm" class="flex flex-col gap-4 mt-2">
    <div class="flex flex-col gap-2">
      <label>Full Name</label>
      <input pInputText formControlName="name" placeholder="John Doe" />
    </div>
    <div class="flex flex-col gap-2">
      <label>Email Address</label>
      <input pInputText formControlName="email" placeholder="john@company.com" />
    </div>
    <div class="flex flex-col gap-2">
      <label>Role</label>
      Using native select or PrimeNG Select depending on installed modules
      <select formControlName="role" class="p-inputtext w-full">
        <option [ngValue]="null">Select Role</option>
        @for (r of availableRoles; track r.value) {
        <option [value]="r.value">{{r.label}}</option>
        }
      </select>
    </div>
  </form>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" (click)="showInviteDialog = false" class="p-button-text"></button>
    <button pButton label="Send Invite" (click)="inviteUser()" [loading]="isSaving()"></button>
  </ng-template>
</p-dialog>

DIALOG: Transfer Ownership
<p-dialog header="Transfer Ownership" [(visible)]="showTransferDialog" [modal]="true" [style]="{width: '400px'}">
  <form [formGroup]="transferForm" class="flex flex-col gap-4 mt-2">
    <div class="bg-yellow-500/10 border border-yellow-500/30 p-3 rounded text-sm text-[var(--text-primary)]">
      Warning: You are about to give full control of <strong>{{ organization()?.name }}</strong> to another user.
    </div>
    <div class="flex flex-col gap-2">
      <label>Select New Owner</label>
      <select formControlName="newOwnerId" class="p-inputtext w-full">
        <option [ngValue]="null">Select Member</option>
        @for (m of activeMembers(); track m._id) {
        <option [value]="m._id">{{m.name}} ({{m.email}})</option>
        }
      </select>
    </div>
    <div class="flex flex-col gap-2">
      <label>Type "CONFIRM" to proceed</label>
      <input pInputText formControlName="confirmName" />
    </div>
  </form>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" (click)="showTransferDialog = false" class="p-button-text"></button>
    <button pButton label="Transfer" class="p-button-danger"
      [disabled]="transferForm.invalid || transferForm.value.confirmName !== 'CONFIRM'"
      (click)="transferOwnership()"></button>
  </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog> -->