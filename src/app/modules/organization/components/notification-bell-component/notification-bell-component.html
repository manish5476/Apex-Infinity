<div class="relative">
  <button class="relative p-2"
          (click)="toggleDropdown()"
          pTooltip="Notifications"
          tooltipPosition="bottom">
    <i class="pi pi-bell text-lg text-[var(--text-primary)]"></i>

    @if (unreadCount > 0) {
      <span class="absolute -top-1 -right-1 bg-red-600 text-white text-[10px]
                   px-1.5 rounded-full font-semibold">
        {{ unreadCount }}
      </span>
    }
  </button>

  @if (showDropdown) {
    <div class="dropdown-panel">
      
      <!-- Category Buttons -->
      <div class="category-bar">
        <button [class.active]="activeTab === 'new'"
                (click)="activeTab = 'new'">New</button>

        <button [class.active]="activeTab === 'approvals'"
                (click)="activeTab = 'approvals'">Approvals</button>

        <button [class.active]="activeTab === 'all'"
                (click)="activeTab = 'all'">All</button>
      </div>

      <!-- Panels -->
      <div class="content-panel">
        @switch (activeTab) {

        @case('new') {
          <ng-container>
            @for (n of realtimeNotifications; track n._id) {
              <div class="notif-item"
                   (click)="markAsRead(n)"
                   [class.unread]="!n.isRead">
                <div class="title">{{ n.title }}</div>
                <div class="msg">{{ n.message }}</div>
                <div class="time">{{ n.createdAt | date:'short' }}</div>
              </div>
            }

            @if (realtimeNotifications.length === 0) {
              <div class="empty">No new notifications.</div>
            }
          </ng-container>
        }

        @case('approvals') {
          <ng-container>
            @for (member of pendingMembers; track member._id) {
              <div class="approval-box">
                <div class="title">{{ member.name }}</div>
                <div class="email">{{ member.email }}</div>

                <p-select appendTo="body"
                          [options]="roles"
                          [(ngModel)]="selectedRoles[member._id]"
                          optionLabel="name"
                          optionValue="_id"
                          placeholder="Role">
                </p-select>

                <p-select appendTo="body"
                          [options]="branches"
                          [(ngModel)]="selectedBranches[member._id]"
                          optionLabel="name"
                          optionValue="_id"
                          placeholder="Branch">
                </p-select>

                <p-button label="Approve"
                          icon="pi pi-check"
                          (click)="approveMember(member)"
                          [disabled]="!selectedRoles[member._id] || !selectedBranches[member._id]">
                </p-button>
              </div>
            }

            @if (pendingMembers.length === 0) {
              <div class="empty">No pending approvals.</div>
            }
          </ng-container>
        }

        @default {
          @for (n of allNotifications; track n._id) {
            <div class="notif-item">
              <div class="title">{{ n.title }}</div>
              <div class="msg">{{ n.message }}</div>
              <div class="time">{{ n.createdAt | date:'short' }}</div>
            </div>
          }
          @if (allNotifications.length === 0) {
            <div class="empty">No notifications.</div>
          }
        }

        }
      </div>

    </div>
  }
</div>