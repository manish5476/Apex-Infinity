<div class="notification-layout">

  <div class="panel-header">
    <div class="nav-segment">
      <button type="button" [class.active]="activeTab === 0" (click)="activeTab = 0">
        <span>New</span>
        @if (unreadCount > 0) { <span class="badge-dot"></span> }
      </button>
      <button type="button" [class.active]="activeTab === 1" (click)="activeTab = 1">
        <span>Approvals</span>
        @if (pendingMembers.length > 0) { <span class="badge-count">{{ pendingMembers.length }}</span> }
      </button>
      <button type="button" [class.active]="activeTab === 2" (click)="activeTab = 2">
        <span>History</span>
      </button>
    </div>
  </div>

  <div class="panel-body">
    
    @if (activeTab === 0) {
      <ul class="notification-list">
        @for (n of realtimeNotifications; track n._id) {
          <li class="notif-item" [class.unread]="!n.isRead" (click)="markAsRead(n)">
            <div class="notif-content">
              <span class="title">{{ n.title }}</span>
              <p class="msg">{{ n.message }}</p>
              <span class="time">{{ n.createdAt | date:'shortTime' }}</span>
            </div>
          </li>
        }
        @if (!isLoading && realtimeNotifications.length === 0) {
          <div class="empty-state">
            <i class="pi pi-check-circle"></i>
            <p>You're all caught up!</p>
          </div>
        }
      </ul>
    }

    @if (activeTab === 1) {
      <ul class="notification-list">
         @for (member of pendingMembers; track member._id) {
          <li class="approval-item">
            <div class="user-info">
              <div>
                <span class="name">{{ member.name }}</span>
                <span class="email">{{ member.email }}</span>
              </div>
              <i class="pi pi-user text-orange-500"></i>
            </div>
            <div class="approval-actions">
              <p-select appendTo="body" [options]="roles" [(ngModel)]="selectedRoles[member._id]" 
                        optionLabel="name" optionValue="_id" placeholder="Select Role">
              </p-select>
              <p-select appendTo="body" [options]="branches" [(ngModel)]="selectedBranches[member._id]" 
                        optionLabel="name" optionValue="_id" placeholder="Select Branch">
              </p-select>
              <p-button label="Approve" icon="pi pi-check" styleClass="w-full" 
                        (onClick)="approveMember(member)"
                        [disabled]="!selectedRoles[member._id] || !selectedBranches[member._id]">
              </p-button>
            </div>
          </li>
        }
      </ul>
    }

    @if (activeTab === 2) {
      <ul class="notification-list">
        @for (n of allNotifications; track n._id) {
          <li class="notif-item">
            <div class="notif-content">
              <span class="title">{{ n.title }}</span>
              <p class="msg">{{ n.message }}</p>
              <span class="time">{{ n.createdAt | date:'medium' }}</span>
            </div>
          </li>
        }
      </ul>
    }
  </div>
</div>
