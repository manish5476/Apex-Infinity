<!-- attendance-manager.component.html -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Attendance Management</h1>
    <p class="text-gray-500">Manage team attendance, approvals, and monitoring</p>
  </div>

  <!-- Tabs using latest PrimeNG Tabs -->
  <div class="card">
    <!-- [(value)]="activeTab()" -->
    <p-tabs [value]="activeTab()" (valueChange)="onTabChange($event)" >
      <p-tablist>
        <p-tab value="0">
          <div class="flex items-center gap-2">
            <i class="pi pi-clock"></i>
            <span>Pending Requests</span>
          </div>
        </p-tab>
        <p-tab value="1">
          <div class="flex items-center gap-2">
            <i class="pi pi-users"></i>
            <span>Team Attendance</span>
          </div>
        </p-tab>
        <p-tab value="2">
          <div class="flex items-center gap-2">
            <i class="pi pi-eye"></i>
            <span>Live Monitoring</span>
          </div>
        </p-tab>
      </p-tablist>
      
      <p-tabpanels>
        <!-- Tab 1: Pending Requests -->
        <p-tabpanel value="0">
          <div class="mb-4">
            <div class="flex justify-between items-center">
              <p-toolbar class="p-0 border-0 bg-transparent">
                <ng-template pTemplate="start">
                  <div class="flex flex-wrap items-center gap-3">
                    <!-- Date Inputs instead of DatePicker -->
                    <div class="flex items-center gap-2">
                      <label class="text-sm text-gray-600">From</label>
                      <input 
                        pInputText 
                        type="date" 
                        [(ngModel)]="filters().startDate" 
                        class="w-40"
                      >
                    </div>
                    
                    <div class="flex items-center gap-2">
                      <label class="text-sm text-gray-600">To</label>
                      <input 
                        pInputText 
                        type="date" 
                        [(ngModel)]="filters().endDate" 
                        class="w-40"
                      >
                    </div>
                    
                    <p-select 
                      [(ngModel)]="filters().department" 
                      [options]="departments()"
                      placeholder="Department"
                      styleClass="w-48"
                    ></p-select>
                    
                    <p-button 
                      label="Apply" 
                      icon="pi pi-filter" 
                      (onClick)="applyFilters()"
                      severity="secondary"
                    ></p-button>
                    
                    <p-button 
                      label="Reset" 
                      icon="pi pi-refresh" 
                      (onClick)="resetFilters()"
                      [text]="true"
                    ></p-button>
                  </div>
                </ng-template>
              </p-toolbar>
            </div>
          </div>

          <!-- Requests Table -->
          <p-table 
            [value]="pendingRequests()" 
            [loading]="isLoading()"
            [paginator]="true" 
            [rows]="10"
            [rowsPerPageOptions]="[10, 25, 50]"
            styleClass="p-datatable-sm"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Employee</th>
                <th>Date</th>
                <th>Type</th>
                <th>Request Details</th>
                <th>Reason</th>
                <th>Submitted</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-request>
              <tr>
                <td>
                  <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                      <span class="text-blue-600 font-semibold">
                        {{ request.employee?.name?.charAt(0) || 'U' }}
                      </span>
                    </div>
                    <div>
                      <p class="font-medium text-gray-800">{{ request.employee?.name || 'Unknown' }}</p>
                      <p class="text-xs text-gray-500">{{ request.employee?.department || '-' }}</p>
                    </div>
                  </div>
                </td>
                
                <td class="font-medium">{{ request.targetDate | date:'mediumDate' }}</td>
                
                <td>
                  <span class="px-2 py-1 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-purple-100 text-purple-700': request.type === 'missed_punch',
                      'bg-blue-100 text-blue-700': request.type === 'correction',
                      'bg-green-100 text-green-700': request.type === 'work_from_home',
                      'bg-orange-100 text-orange-700': request.type === 'on_duty'
                    }">
                    {{ request.type?.replace('_', ' ') | titlecase }}
                  </span>
                </td>
                
                <td>
                  <div class="text-sm">
                    <p>In: {{ formatTime(request.newFirstIn) }}</p>
                    <p>Out: {{ formatTime(request.newLastOut) }}</p>
                  </div>
                </td>
                
                <td class="max-w-xs">
                  <p class="text-sm text-gray-600 truncate">{{ request.reason }}</p>
                </td>
                
                <td>
                  <p class="text-sm">{{ request.createdAt | date:'shortDate' }}</p>
                </td>
                
                <td>
                  <div class="flex gap-2">
                    <p-button 
                      icon="pi pi-check" 
                      severity="success" 
                      [rounded]="true"
                      [text]="true"
                      [outlined]="true"
                      (onClick)="handleRequest(request._id, 'approved')"
                      [pTooltip]="'Approve'"
                    ></p-button>
                    
                    <p-button 
                      icon="pi pi-times" 
                      severity="danger" 
                      [rounded]="true"
                      [text]="true"
                      [outlined]="true"
                      (onClick)="handleRequest(request._id, 'rejected')"
                      [pTooltip]="'Reject'"
                    ></p-button>
                    
                    <p-button 
                      icon="pi pi-eye" 
                      severity="info" 
                      [rounded]="true"
                      [text]="true"
                      [outlined]="true"
                      [pTooltip]="'View Details'"
                    ></p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="7" class="text-center py-8 text-gray-500">
                  <i class="pi pi-inbox text-3xl mb-2"></i>
                  <p>No pending requests found</p>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabpanel>

        <!-- Tab 2: Team Attendance -->
        <p-tabpanel value="1">
          <div class="mb-4">
            <div class="flex justify-between items-center">
              <div class="flex flex-wrap items-center gap-3">
                <p-multiSelect 
                  [options]="statusOptions()" 
                  [(ngModel)]="filters().status"
                  placeholder="Filter by Status"
                  styleClass="w-64"
                ></p-multiSelect>
                
                <p-select 
                  [(ngModel)]="filters().department" 
                  [options]="departments()"
                  placeholder="Department"
                  styleClass="w-48"
                ></p-select>
                
                <div class="flex items-center gap-2">
                  <p-checkbox 
                    [(ngModel)]="filters().includeSubordinates" 
                    binary="true"
                    inputId="includeSub"
                  ></p-checkbox>
                  <label for="includeSub" class="text-sm text-gray-600">Include Subordinates</label>
                </div>
              </div>
              
              <div class="flex gap-2">
                <p-button 
                  label="Export" 
                  icon="pi pi-download" 
                  (onClick)="exportData()"
                  severity="secondary"
                ></p-button>
                
                <p-button 
                  label="Refresh" 
                  icon="pi pi-refresh" 
                  (onClick)="loadTeamAttendance()"
                ></p-button>
              </div>
            </div>
          </div>

          <!-- Team Attendance Table -->
          <p-table 
            [value]="teamAttendance()" 
            [loading]="isLoading()"
            [paginator]="true" 
            [rows]="15"
            [rowsPerPageOptions]="[10, 25, 50]"
            styleClass="p-datatable-sm"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Employee</th>
                <th>Date</th>
                <th>Status</th>
                <th>In Time</th>
                <th>Out Time</th>
                <th>Work Hours</th>
                <th>Late By</th>
                <th>Overtime</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-record>
              <tr>
                <td>
                  <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                      <span class="text-blue-600 font-semibold">
                        {{ record.employee?.name?.charAt(0) || 'U' }}
                      </span>
                    </div>
                    <div>
                      <p class="font-medium text-gray-800">{{ record.employee?.name || 'Unknown' }}</p>
                      <p class="text-xs text-gray-500">{{ record.employee?.employeeId || '-' }}</p>
                    </div>
                  </div>
                </td>
                
                <td class="font-medium">{{ record.date | date:'mediumDate' }}</td>
                
                <td>
                  <span class="px-2 py-1 rounded-full text-xs font-medium"
                    [ngClass]="getStatusClass(record.status)">
                    {{ attendanceService.getStatusDisplayText(record.status) }}
                  </span>
                </td>
                
                <td class="font-mono">{{ formatTime(record.firstIn) }}</td>
                <td class="font-mono">{{ formatTime(record.lastOut) }}</td>
                <td class="font-semibold">{{ record.workHours || 0 }} hrs</td>
                <td>
                  @if (record.lateMinutes && record.lateMinutes > 0) {
                    <span class="text-yellow-600 font-medium">{{ record.lateMinutes }} min</span>
                  } @else {
                    <span class="text-green-500">On Time</span>
                  }
                </td>
                <td>
                  @if (record.overtimeHours && record.overtimeHours > 0) {
                    <span class="text-purple-600 font-medium">+{{ record.overtimeHours }} hrs</span>
                  } @else {
                    <span>-</span>
                  }
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabpanel>

        <!-- Tab 3: Live Monitoring -->
        <p-tabpanel value="2">
          <div class="mb-4">
            <div class="flex items-center gap-3">
              <div class="flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-full">
                <i class="pi pi-circle-fill animate-pulse"></i>
                <span class="text-sm font-medium">Live Updates</span>
              </div>
              <p class="text-sm text-gray-500">Auto-refreshes every 30 seconds</p>
            </div>
          </div>

          <!-- Live Cards Grid - Fixed filter issue -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-lg shadow border">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">Currently Working</p>
                  <p class="text-2xl font-bold text-gray-800">
                    {{ getCurrentlyWorking() }}
                  </p>
                </div>
                <i class="pi pi-users text-2xl text-blue-500"></i>
              </div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow border">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">On Break</p>
                  <p class="text-2xl font-bold text-gray-800">
                    {{ getOnBreak() }}
                  </p>
                </div>
                <i class="pi pi-coffee text-2xl text-orange-500"></i>
              </div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow border">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">Not Checked In</p>
                  <p class="text-2xl font-bold text-gray-800">
                    {{ getNotCheckedIn() }}
                  </p>
                </div>
                <i class="pi pi-clock text-2xl text-red-500"></i>
              </div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow border">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">Work From Home</p>
                  <p class="text-2xl font-bold text-gray-800">
                    {{ getWFHCount() }}
                  </p>
                </div>
                <i class="pi pi-home text-2xl text-green-500"></i>
              </div>
            </div>
          </div>

          <!-- Live Activity Feed -->
          <div class="bg-white rounded-lg shadow border">
            <div class="p-4 border-b">
              <h3 class="font-semibold text-gray-800">Recent Activity</h3>
            </div>
            
            <div class="divide-y">
              @for (activity of liveAttendance().slice(0, 10); track activity._id) {
                <div class="p-4 hover:bg-gray-50 transition-colors">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <span class="text-blue-600 font-semibold">
                          {{ activity.employee?.name?.charAt(0) || 'U' }}
                        </span>
                      </div>
                      
                      <div>
                        <p class="font-medium text-gray-800">{{ activity.employee?.name || 'Unknown' }}</p>
                        <div class="flex items-center gap-3 text-sm text-gray-500">
                          <span>{{ activity.employee?.department || '-' }}</span>
                          <span>•</span>
                          @if (activity.lastPunch) {
                            <span>
                              {{ attendanceService.getStatusDisplayText(activity.lastPunch.type) }} 
                              at {{ formatTime(activity.lastPunch.time) }}
                            </span>
                          }
                        </div>
                      </div>
                    </div>
                    
                    <div class="flex items-center gap-4">
                      @if (activity.firstIn && !activity.lastOut) {
                        <div class="flex items-center gap-2">
                          <i class="pi pi-circle-fill text-green-500 animate-pulse"></i>
                          <span class="text-sm font-medium text-green-600">Working</span>
                        </div>
                      } @else if (activity.breakStart && !activity.breakEnd) {
                        <div class="flex items-center gap-2">
                          <i class="pi pi-circle-fill text-orange-500"></i>
                          <span class="text-sm font-medium text-orange-600">On Break</span>
                        </div>
                      } @else if (!activity.firstIn) {
                        <div class="flex items-center gap-2">
                          <i class="pi pi-circle-fill text-gray-400"></i>
                          <span class="text-sm font-medium text-gray-500">Not Started</span>
                        </div>
                      }
                      
                      <p-button 
                        icon="pi pi-eye" 
                        [text]="true" 
                        [rounded]="true"
                        size="small"
                      ></p-button>
                    </div>
                  </div>
                </div>
              }
              
              @if (liveAttendance().length === 0) {
                <div class="p-8 text-center text-gray-500">
                  <i class="pi pi-users text-3xl mb-2"></i>
                  <p>No live activity data available</p>
                </div>
              }
            </div>
          </div>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>
</div>

<!-- attendance-manager.component.html
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="min-h-screen bg-gray-50 p-6">
  Header
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Attendance Management</h1>
    <p class="text-gray-500">Manage team attendance, approvals, and monitoring</p>
  </div>

  Tabs
  <p-tabView [(activeIndex)]="activeTab()" class="custom-tabs">
    Tab 1: Pending Requests
    <p-tabPanel header="Pending Requests">
      <div class="mb-4">
        <div class="flex justify-between items-center">
          <p-toolbar class="p-0 border-0 bg-transparent">
            <ng-template pTemplate="left">
              <div class="flex items-center gap-3">
                <p-datepicker 
                  [(ngModel)]="filters().startDate" 
                  placeholder="Start Date" 
                  dateFormat="yy-mm-dd"
                  [showIcon]="true"
                  styleClass="w-40"
                ></p-datepicker>
                <span class="text-gray-400">to</span>
                <p-datepicker 
                  [(ngModel)]="filters().endDate" 
                  placeholder="End Date" 
                  dateFormat="yy-mm-dd"
                  [showIcon]="true"
                  styleClass="w-40"
                ></p-datepicker>
                
                <p-select 
                  [(ngModel)]="filters().department" 
                  [options]="departments()"
                  placeholder="Department"
                  styleClass="w-48"
                ></p-select>
                
                <p-button 
                  label="Apply" 
                  icon="pi pi-filter" 
                  (onClick)="applyFilters()"
                  severity="secondary"
                ></p-button>
                
                <p-button 
                  label="Reset" 
                  icon="pi pi-refresh" 
                  (onClick)="resetFilters()"
                  [text]="true"
                ></p-button>
              </div>
            </ng-template>
          </p-toolbar>
        </div>
      </div>

      Requests Table
      <p-table 
        [value]="pendingRequests()" 
        [loading]="isLoading()"
        [paginator]="true" 
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Employee</th>
            <th>Date</th>
            <th>Type</th>
            <th>Request Details</th>
            <th>Reason</th>
            <th>Submitted</th>
            <th>Actions</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-request>
          <tr>
            <td>
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <span class="text-blue-600 font-semibold">
                    {{ request.employee?.name?.charAt(0) || 'U' }}
                  </span>
                </div>
                <div>
                  <p class="font-medium text-gray-800">{{ request.employee?.name || 'Unknown' }}</p>
                  <p class="text-xs text-gray-500">{{ request.employee?.department || '-' }}</p>
                </div>
              </div>
            </td>
            
            <td class="font-medium">{{ request.targetDate | date:'mediumDate' }}</td>
            
            <td>
              <span class="px-2 py-1 rounded-full text-xs font-medium"
                [ngClass]="{
                  'bg-purple-100 text-purple-700': request.type === 'missed_punch',
                  'bg-blue-100 text-blue-700': request.type === 'correction',
                  'bg-green-100 text-green-700': request.type === 'work_from_home',
                  'bg-orange-100 text-orange-700': request.type === 'on_duty'
                }">
                {{ request.type?.replace('_', ' ') | titlecase }}
              </span>
            </td>
            
            <td>
              <div class="text-sm">
                <p>In: {{ formatTime(request.newFirstIn) }}</p>
                <p>Out: {{ formatTime(request.newLastOut) }}</p>
              </div>
            </td>
            
            <td class="max-w-xs">
              <p class="text-sm text-gray-600 truncate">{{ request.reason }}</p>
            </td>
            
            <td>
              <p class="text-sm">{{ request.createdAt | date:'shortDate' }}</p>
            </td>
            
            <td>
              <div class="flex gap-2">
                <p-button 
                  icon="pi pi-check" 
                  severity="success" 
                  [rounded]="true"
                  [text]="true"
                  [outlined]="true"
                  (onClick)="handleRequest(request._id, 'approved')"
                  tooltip="Approve"
                ></p-button>
                
                <p-button 
                  icon="pi pi-times" 
                  severity="danger" 
                  [rounded]="true"
                  [text]="true"
                  [outlined]="true"
                  (onClick)="handleRequest(request._id, 'rejected')"
                  tooltip="Reject"
                ></p-button>
                
                <p-button 
                  icon="pi pi-eye" 
                  severity="info" 
                  [rounded]="true"
                  [text]="true"
                  [outlined]="true"
                  tooltip="View Details"
                ></p-button>
              </div>
            </td>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center py-8 text-gray-500">
              <i class="pi pi-inbox text-3xl mb-2"></i>
              <p>No pending requests found</p>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>

    Tab 2: Team Attendance
    <p-tabPanel header="Team Attendance">
      <div class="mb-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-3">
            <p-multiSelect 
              [options]="statusOptions()" 
              [(ngModel)]="filters().status"
              placeholder="Filter by Status"
              styleClass="w-64"
            ></p-multiSelect>
            
            <p-select 
              [(ngModel)]="filters().department" 
              [options]="departments()"
              placeholder="Department"
              styleClass="w-48"
            ></p-select>
            
            <div class="flex items-center gap-2">
              <p-checkbox 
                [(ngModel)]="filters().includeSubordinates" 
                binary="true"
                inputId="includeSub"
              ></p-checkbox>
              <label for="includeSub" class="text-sm text-gray-600">Include Subordinates</label>
            </div>
          </div>
          
          <div class="flex gap-2">
            <p-button 
              label="Export" 
              icon="pi pi-download" 
              (onClick)="exportData()"
              severity="secondary"
            ></p-button>
            
            <p-button 
              label="Refresh" 
              icon="pi pi-refresh" 
              (onClick)="loadTeamAttendance()"
            ></p-button>
          </div>
        </div>
      </div>

      Team Attendance Table
      <p-table 
        [value]="teamAttendance()" 
        [loading]="isLoading()"
        [paginator]="true" 
        [rows]="15"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Employee</th>
            <th>Date</th>
            <th>Status</th>
            <th>In Time</th>
            <th>Out Time</th>
            <th>Work Hours</th>
            <th>Late By</th>
            <th>Overtime</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-record>
          <tr>
            <td>
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <span class="text-blue-600 font-semibold">
                    {{ record.employee?.name?.charAt(0) || 'U' }}
                  </span>
                </div>
                <div>
                  <p class="font-medium text-gray-800">{{ record.employee?.name || 'Unknown' }}</p>
                  <p class="text-xs text-gray-500">{{ record.employee?.employeeId || '-' }}</p>
                </div>
              </div>
            </td>
            
            <td class="font-medium">{{ record.date | date:'mediumDate' }}</td>
            
            <td>
              <span class="px-2 py-1 rounded-full text-xs font-medium"
                [ngClass]="getStatusClass(record.status)">
                {{ attendanceService.getStatusDisplayText(record.status) }}
              </span>
            </td>
            
            <td class="font-mono">{{ formatTime(record.firstIn) }}</td>
            <td class="font-mono">{{ formatTime(record.lastOut) }}</td>
            <td class="font-semibold">{{ record.workHours || 0 }} hrs</td>
            <td>
              @if (record.lateMinutes && record.lateMinutes > 0) {
                <span class="text-yellow-600 font-medium">{{ record.lateMinutes }} min</span>
              } @else {
                <span class="text-green-500">On Time</span>
              }
            </td>
            <td>
              @if (record.overtimeHours && record.overtimeHours > 0) {
                <span class="text-purple-600 font-medium">+{{ record.overtimeHours }} hrs</span>
              } @else {
                <span>-</span>
              }
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>

    Tab 3: Live Monitoring
    <p-tabPanel header="Live Monitoring">
      <div class="mb-4">
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-full">
            <i class="pi pi-circle-fill animate-pulse"></i>
            <span class="text-sm font-medium">Live Updates</span>
          </div>
          <p class="text-sm text-gray-500">Auto-refreshes every 30 seconds</p>
        </div>
      </div>

      Live Cards Grid
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-white p-4 rounded-lg shadow border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500">Currently Working</p>
              <p class="text-2xl font-bold text-gray-800">
                {{ liveAttendance().filter(a => a.firstIn && !a.lastOut).length }}
              </p>
            </div>
            <i class="pi pi-users text-2xl text-blue-500"></i>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500">On Break</p>
              <p class="text-2xl font-bold text-gray-800">
                {{ liveAttendance().filter(a => a.breakStart && !a.breakEnd).length }}
              </p>
            </div>
            <i class="pi pi-coffee text-2xl text-orange-500"></i>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500">Not Checked In</p>
              <p class="text-2xl font-bold text-gray-800">
                {{ liveAttendance().filter(a => !a.firstIn).length }}
              </p>
            </div>
            <i class="pi pi-clock text-2xl text-red-500"></i>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500">Work From Home</p>
              <p class="text-2xl font-bold text-gray-800">
                {{ liveAttendance().filter(a => a.isWFH).length }}
              </p>
            </div>
            <i class="pi pi-home text-2xl text-green-500"></i>
          </div>
        </div>
      </div>

      Live Activity Feed
      <div class="bg-white rounded-lg shadow border">
        <div class="p-4 border-b">
          <h3 class="font-semibold text-gray-800">Recent Activity</h3>
        </div>
        
        <div class="divide-y">
          @for (activity of liveAttendance().slice(0, 10); track activity._id) {
            <div class="p-4 hover:bg-gray-50 transition-colors">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                    <span class="text-blue-600 font-semibold">
                      {{ activity.employee?.name?.charAt(0) || 'U' }}
                    </span>
                  </div>
                  
                  <div>
                    <p class="font-medium text-gray-800">{{ activity.employee?.name || 'Unknown' }}</p>
                    <div class="flex items-center gap-3 text-sm text-gray-500">
                      <span>{{ activity.employee?.department || '-' }}</span>
                      <span>•</span>
                      @if (activity.lastPunch) {
                        <span>
                          {{ attendanceService.getStatusDisplayText(activity.lastPunch.type) }} 
                          at {{ formatTime(activity.lastPunch.time) }}
                        </span>
                      }
                    </div>
                  </div>
                </div>
                
                <div class="flex items-center gap-4">
                  @if (activity.firstIn && !activity.lastOut) {
                    <div class="flex items-center gap-2">
                      <i class="pi pi-circle-fill text-green-500 animate-pulse"></i>
                      <span class="text-sm font-medium text-green-600">Working</span>
                    </div>
                  } @else if (activity.breakStart && !activity.breakEnd) {
                    <div class="flex items-center gap-2">
                      <i class="pi pi-circle-fill text-orange-500"></i>
                      <span class="text-sm font-medium text-orange-600">On Break</span>
                    </div>
                  } @else if (!activity.firstIn) {
                    <div class="flex items-center gap-2">
                      <i class="pi pi-circle-fill text-gray-400"></i>
                      <span class="text-sm font-medium text-gray-500">Not Started</span>
                    </div>
                  }
                  
                  <p-button 
                    icon="pi pi-eye" 
                    [text]="true" 
                    [rounded]="true"
                    size="small"
                  ></p-button>
                </div>
              </div>
            </div>
          }
          
          @if (liveAttendance().length === 0) {
            <div class="p-8 text-center text-gray-500">
              <i class="pi pi-users text-3xl mb-2"></i>
              <p>No live activity data available</p>
            </div>
          }
        </div>
      </div>
    </p-tabPanel>
  </p-tabView>
</div> -->