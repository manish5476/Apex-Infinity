<!-- shift-manager.component.html -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Shift Management</h1>
        <p class="text-gray-500">Create and manage work shifts for employees</p>
      </div>

      <p-button label="Create Shift" icon="pi pi-plus" (onClick)="openCreate()"></p-button>
    </div>
  </div>

  <!-- Shifts Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    @for (shift of shifts(); track shift._id) {
    <div class="bg-white rounded-lg shadow border hover:shadow-lg transition-shadow">
      <div class="p-5">
        <!-- Header -->
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="text-lg font-semibold text-gray-800">{{ shift.name }}</h3>
            <span class="px-2 py-1 rounded-full text-xs font-medium" [ngClass]="getShiftColor(shift.type)">
              {{ shift.type | titlecase }}
            </span>
          </div>
          <div class="flex items-center gap-1">
            <p-button icon="pi pi-pencil" [text]="true" [rounded]="true" (onClick)="openEdit(shift)"
              tooltip="Edit"></p-button>
            <p-button icon="pi pi-trash" [text]="true" [rounded]="true" severity="danger"
              (onClick)="deleteShift(shift._id)" tooltip="Delete"></p-button>
          </div>
        </div>

        <!-- Shift Timings -->
        <div class="space-y-3 mb-4">
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Timings</span>
            <span class="font-mono font-semibold text-gray-800">
              {{ shift.startTime?.substring(0, 5) }} - {{ shift.endTime?.substring(0, 5) }}
            </span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Duration</span>
            <span class="font-medium text-gray-800">
              {{ calculateDuration() }}
            </span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Break</span>
            <span class="font-medium text-gray-800">
              {{ shift.breakDuration || 0 }} minutes
            </span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Grace Period</span>
            <span class="font-medium text-gray-800">
              {{ shift.gracePeriod || 0 }} minutes
            </span>
          </div>
        </div>

        <!-- Working Days -->
        <div class="mb-4">
          <p class="text-sm text-gray-500 mb-2">Working Days</p>
          <div class="flex flex-wrap gap-1">
            @for (day of daysOfWeek; track day.value) {
            @if (shift.workingDays?.includes(day.value)) {
            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">
              {{ day.label.substring(0, 3) }}
            </span>
            }
            }
          </div>
        </div>

        <!-- Status & Info -->
        <div class="flex items-center justify-between pt-4 border-t border-gray-200">
          <div class="flex items-center gap-2">
            @if (shift.isActive) {
            <i class="pi pi-circle-fill text-green-500 text-xs"></i>
            <span class="text-sm text-green-600">Active</span>
            } @else {
            <i class="pi pi-circle-fill text-gray-400 text-xs"></i>
            <span class="text-sm text-gray-500">Inactive</span>
            }
          </div>

          <div class="flex items-center gap-3 text-sm text-gray-500">
            @if (shift.overtimeAllowed) {
            <i class="pi pi-clock" tooltip="Overtime Allowed"></i>
            }
            @if (shift.autoApproval) {
            <i class="pi pi-check-circle" tooltip="Auto Approval"></i>
            }
          </div>
        </div>
      </div>
    </div>
    } @empty {
    <div class="col-span-3">
      <div class="bg-white rounded-lg shadow border p-8 text-center">
        <i class="pi pi-clock text-4xl text-gray-400 mb-3"></i>
        <h3 class="text-lg font-medium text-gray-700 mb-2">No Shifts Created</h3>
        <p class="text-gray-500 mb-4">Create your first shift to get started</p>
        <p-button label="Create First Shift" icon="pi pi-plus" (onClick)="openCreate()"></p-button>
      </div>
    </div>
    }
  </div>
</div>

<!-- Shift Dialog -->
<p-dialog [visible]="showDialog()" [header]="(isEditMode() ? 'Edit' : 'Create') + ' Shift'" [modal]="true"
  [style]="{ width: '550px' }">
  <form [formGroup]="shiftForm" class="space-y-4">
    <!-- Basic Info -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Shift Name *</label>
        <input pInputText formControlName="name" placeholder="e.g., Morning Shift" class="w-full" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Shift Type</label>
        <p-select formControlName="type" [options]="shiftTypes" styleClass="w-full"></p-select>
      </div>
    </div>

    <!-- Timings -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Start Time *</label>
        <input type="time" formControlName="startTime" class="w-full p-2 border rounded-lg" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">End Time *</label>
        <input type="time" formControlName="endTime" class="w-full p-2 border rounded-lg" />
      </div>
    </div>

    <!-- Duration Display -->
    <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
      <div class="flex items-center justify-between">
        <span class="text-sm text-blue-700">Shift Duration (excluding break):</span>
        <span class="font-semibold text-blue-800">{{ calculateDuration() }}</span>
      </div>
    </div>

    <!-- Break & Grace -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Break Duration (minutes)</label>
        <p-inputNumber formControlName="breakDuration" [min]="0" [max]="240" mode="decimal"
          styleClass="w-full"></p-inputNumber>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Grace Period (minutes)</label>
        <p-inputNumber formControlName="gracePeriod" [min]="0" [max]="60" mode="decimal"
          styleClass="w-full"></p-inputNumber>
      </div>
    </div>

    <!-- Working Days -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Working Days</label>
      <div class="flex flex-wrap gap-2">
        @for (day of daysOfWeek; track day.value) {
        <button type="button" (click)="toggleDay(day.value)"
          class="px-3 py-2 border rounded-lg text-sm transition-colors" [ngClass]="{
              'border-blue-500 bg-blue-50 text-blue-700': isDaySelected(day.value),
              'border-gray-200 hover:border-gray-300': !isDaySelected(day.value)
            }">
          {{ day.label }}
        </button>
        }
      </div>
    </div>

    <!-- Additional Settings -->
    <div class="grid grid-cols-2 gap-4">
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="overtimeAllowed" binary="true" inputId="overtime"></p-checkbox>
        <label for="overtime" class="text-sm text-gray-700">Allow Overtime</label>
      </div>

      <div class="flex items-center gap-2">
        <p-checkbox formControlName="autoApproval" binary="true" inputId="autoApprove"></p-checkbox>
        <label for="autoApprove" class="text-sm text-gray-700">Auto Approval</label>
      </div>

      <div class="flex items-center gap-2">
        <p-checkbox formControlName="isActive" binary="true" inputId="active"></p-checkbox>
        <label for="active" class="text-sm text-gray-700">Active</label>
      </div>
    </div>

    <!-- Description -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
      <textarea pInputTextarea formControlName="description" rows="3" placeholder="Optional shift description..."
        class="w-full"></textarea>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button pButton label="Cancel" class="p-button-text" (click)="showDialog.set(false)"></button>
    <button pButton label="Save Shift" class="p-button-primary" (click)="onSubmit()"
      [disabled]="shiftForm.invalid || isLoading()"></button>
  </ng-template>
</p-dialog>


<!-- <p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="list-page-container">
  <div class="themed-card list-content-area">
    
    <div class="se-filter-bar mb-4">
      
      <div class="se-filter-field">
        <label>Shift Type</label>
        <p-select 
          [options]="typeOptions" 
          [(ngModel)]="filter.type" 
          optionLabel="label" optionValue="value"
          (onChange)="applyLocalFilters()"
          styleClass="w-full">
        </p-select>
      </div>

      <div class="se-filter-field">
        <label>Search</label>
        <input 
          pInputText 
          [(ngModel)]="filter.search" 
          (input)="applyLocalFilters()" 
          placeholder="Search Shift Name..." 
          class="w-full" />
      </div>

      <div class="se-filter-actions">
        <p-button label="Reset" icon="pi pi-refresh" styleClass="p-button-outlined p-button-secondary" (onClick)="resetFilters()"></p-button>
      </div>

      <div class="se-filter-right">
        <p-button label="Create Shift" icon="pi pi-plus" (onClick)="openCreate()" styleClass="p-button-primary"></p-button>
      </div>
    </div>

    <div class="list-grid-wrapper h-[600px]">
      <app-ag-share-grid 
        [columns]="column" 
        [data]="filteredData" 
        [showActions]="false"
        (gridEvent)="handleGridEvent($event)">
      </app-ag-share-grid>
    </div>

  </div>
</div>

<p-dialog [(visible)]="showDialog" [header]="isEditMode ? 'Edit Shift' : 'New Shift'" [modal]="true" [style]="{width: '550px'}">
  </p-dialog>
<!-- <p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="list-page-container">
  <div class="themed-card list-content-area">
    
    <div class="flex justify-between items-center mb-4 p-4 border-b border-gray-100">
      <div>
        <h2 class="text-xl font-bold text-gray-800">Shift Configuration</h2>
        <p class="text-sm text-gray-500">Define working hours and week-offs</p>
      </div>
      <p-button label="Create Shift" icon="pi pi-plus" (onClick)="openCreate()"></p-button>
    </div>

    <div class="list-grid-wrapper h-[600px]">
      <app-ag-share-grid [columns]="column" [data]="data" (gridEvent)="handleGridEvent($event)"></app-ag-share-grid>
    </div>

  </div>
</div>

<p-dialog [(visible)]="showDialog" [header]="isEditMode ? 'Edit Shift' : 'New Shift'" [modal]="true" [style]="{width: '550px'}">
  <form [formGroup]="shiftForm" class="grid grid-cols-2 gap-4 pt-2">
    
    <div class="col-span-2 flex flex-col gap-2">
      <label class="font-medium text-sm">Shift Name</label>
      <input pInputText formControlName="name" placeholder="e.g. Morning Shift" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-medium text-sm">Start Time</label>
      <input type="time" pInputText formControlName="startTime" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-medium text-sm">End Time</label>
      <input type="time" pInputText formControlName="endTime" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-medium text-sm">Grace Period (Min)</label>
      <p-inputNumber formControlName="gracePeriodMins" suffix=" min"></p-inputNumber>
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-medium text-sm">Min Hours (Full Day)</label>
      <p-inputNumber formControlName="minFullDayHrs" suffix=" hrs"></p-inputNumber>
    </div>

    <div class="col-span-2 flex flex-col gap-2">
      <label class="font-medium text-sm">Weekly Offs</label>
      <p-multiSelect [options]="weekDays" formControlName="weeklyOffs" optionLabel="name" optionValue="value" display="chip"></p-multiSelect>
    </div>

    <div class="col-span-2 flex items-center justify-between border p-3 rounded bg-gray-50">
      <span class="text-sm">Is Night Shift? (Ends next day)</span>
      <p-toggleswitch formControlName="isNightShift"></p-toggleswitch>
    </div>

  </form>

  <ng-template pTemplate="footer">
    <button pButton label="Cancel" class="p-button-text" (click)="showDialog = false"></button>
    <button pButton label="Save Shift" (click)="onSubmit()" [disabled]="shiftForm.invalid"></button>
  </ng-template>
</p-dialog> --> -->